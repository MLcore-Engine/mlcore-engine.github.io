<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Go 语言基础知识 - 高新 | AI平台开发工程师</title>
<meta name=description content="AI平台开发工程师，专注于AI平台工程和Kubernetes云原生技术。拥有AI平台开发、GPU资源优化和AI服务部署经验"><meta name=generator content="Hugo 0.145.0"><link href=https://mlcore-engine.github.io//index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://mlcore-engine.github.io/golang/foundation/><link rel=stylesheet href=https://mlcore-engine.github.io/css/theme.min.css><link rel=stylesheet href=https://mlcore-engine.github.io/css/chroma.min.css><script defer src=https://mlcore-engine.github.io//js/fontawesome6/all.min.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js integrity="sha256-H3cjtrm/ztDeuhCN9I4yh4iN2Ybx/y1RM7rMmAesA0k=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js integrity="sha256-4XodgW4TwIJuDtf+v6vDJ39FVxI0veC/kSCCmnFp7ck=" crossorigin=anonymous></script><script src=https://mlcore-engine.github.io/js/bundle.js></script><style>@media screen and (min-width:480px){.sidebar{flex:0 0 20%!important;max-width:20%!important}main{flex:0 0 80%!important;max-width:80%!important}}body{background-color:#f8f5e6!important;font-family:kaiti,stkaiti,楷体,楷体_gb2312,simkai,华文楷体,Kai,-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif!important;font-size:20px!important;line-height:1.8!important}.container,.content-container,main{background-color:#f8f5e6!important}.sidebar{background-color:inherit;font-size:16px!important}h1,h2,h3,h4,h5,h6{font-family:kaiti,stkaiti,楷体,楷体_gb2312,simkai,华文楷体,Kai,noto serif,Georgia,serif!important;font-weight:600!important;line-height:1.5!important}h1{font-size:2.4em!important}h2{font-size:2em!important}h3{font-size:1.7em!important}h4{font-size:1.5em!important}h5{font-size:1.3em!important}h6{font-size:1.2em!important}p{font-size:20px!important;margin-bottom:1.2em!important}li{font-size:20px!important;margin-bottom:.5em!important}article,.content,.post-content,main p,main li,main td,main th,blockquote,.markdown{font-size:20px!important}pre,code{font-family:jetbrains mono,Consolas,Monaco,andale mono,ubuntu mono,monospace!important;font-size:1.1em!important}a{color:#06c!important;text-decoration:none!important}a:hover{text-decoration:underline!important}table{font-size:20px!important}</style><meta property="og:url" content="https://mlcore-engine.github.io/golang/foundation/"><meta property="og:site_name" content="高新 | AI平台开发工程师"><meta property="og:title" content="Go 语言基础知识"><meta property="og:description" content='Go 语言基础知识大全 目录 环境配置 基本数据类型 变量和常量 运算符 控制结构 复合数据类型 函数 方法和接口 错误处理 并发编程 输入输出 包和模块 最佳实践 环境配置 Go 代理设置 go env -w GOPROXY=https://goproxy.cn,direct go env -w GOPROXY=https://gocenter.io,direct 私有库配置 go env -w GOPRIVATE=your-private-repo.com git config --global url."https://username:token@private-repo.com".insteadOf "https://private-repo.com" 基本数据类型 整数类型 有符号整数: int8, int16, int32(rune), int64, int 无符号整数: uint8(byte), uint16, uint32, uint64, uint, uintptr 浮点数和复数 // 浮点数 var f1 float32 = 3.14 var f2 float64 = 3.14159 // 复数 var x complex128 = complex(1, 2) // 1+2i fmt.Println(real(x*y)) // 提取实部 fmt.Println(imag(x*y)) // 提取虚部 布尔类型 var b bool = true // && 的优先级高于 || if &#39;a&#39; <= c && c <= &#39;z&#39; || &#39;A&#39; <= c && c <= &#39;Z&#39; { // 处理字母 } 字符串 // 字符串操作 s := "hello world" len(s) // 字节数 utf8.RuneCountInString(s) // 字符数 // 修改字符串 c := []byte(s) c[0] = &#39;H&#39; s2 := string(c) // 字符串连接（高效方式） var buffer bytes.Buffer buffer.WriteString("hello") buffer.WriteString(" world") result := buffer.String() 变量和常量 变量声明的四种方式 // 1. 短变量声明 s := "hello" // 2. var 声明 var s string // 3. var 声明带初始化 var s = "hello" // 4. var 声明带类型和初始化 var s string = "hello" 常量和 iota const Pi = 3.14159 // iota 枚举器 type Weekday int const ( Sunday Weekday = iota // 0 Monday // 1 Tuesday // 2 Wednesday // 3 Thursday // 4 Friday // 5 Saturday // 6 ) 运算符 算术运算符 + - * / % ++ -- 位运算符 & // AND | // OR ^ // XOR (一元时表示按位取反) &^ // AND NOT (位清除) << // 左移 >> // 右移 // 实例 var x uint8 = 1<<1 | 1<<5 // 00100010 var y uint8 = 1<<1 | 1<<2 // 00000110 fmt.Printf("%08b\n", x&amp;y) // 00000010 fmt.Printf("%08b\n", x|y) // 00100110 fmt.Printf("%08b\n", x^y) // 00100100 fmt.Printf("%08b\n", x&^y) // 00100000 比较运算符 == != < <= > >= 逻辑运算符 && || ! 控制结构 if 语句 if condition { // 代码块 } else if condition2 { // 代码块 } else { // 代码块 } // if 初始化语句 if err := function(); err != nil { return err } switch 语句 // 表达式 switch switch value { case 1: fmt.Println("one") case 2, 3: fmt.Println("two or three") default: fmt.Println("other") } // 类型 switch switch v := x.(type) { case string: fmt.Printf("字符串: %s\n", v) case int: fmt.Printf("整数: %d\n", v) default: fmt.Printf("未知类型\n") } for 循环 // 基本 for 循环 for i := 0; i < 10; i++ { fmt.Println(i) } // while 风格 for condition { // 代码块 } // 无限循环 for { // 代码块 } // range 循环 for index, value := range slice { fmt.Printf("%d: %v\n", index, value) } 复合数据类型 数组 // 数组声明和初始化 var arr [5]int arr2 := [5]int{1, 2, 3, 4, 5} arr3 := [...]int{1, 2, 3} // 编译器推断长度 // 数组是值类型，传递时会复制 func modifyArray(arr *[5]int) { arr[0] = 100 } 切片 (Slice) // 创建切片 s1 := make([]int, 5) // 长度为5 s2 := make([]int, 5, 10) // 长度5，容量10 s3 := []int{1, 2, 3} // 切片操作 s1 = append(s1, 6) // 追加元素 copy(dest, src) // 复制切片 // 切片表达式 s[low:high] // 包含low，不包含high s[low:] // 从low到末尾 s[:high] // 从开始到high s[:] // 整个切片 // 删除元素 func remove(slice []int, i int) []int { copy(slice[i:], slice[i+1:]) return slice[:len(slice)-1] } 映射 (Map) // 创建和初始化 m1 := make(map[string]int) m2 := map[string]int{ "alice": 25, "bob": 30, } // 操作 m1["key"] = value value := m1["key"] delete(m1, "key") // 检查键是否存在 if value, ok := m1["key"]; ok { fmt.Println("存在:", value) } // 遍历 for key, value := range m1 { fmt.Printf("%s: %d\n", key, value) } 结构体 // 定义结构体 type Person struct { Name string Age int addr *Address // 嵌入指针 } type Address struct { City, Country string } // 创建结构体 p1 := Person{"Alice", 25, &amp;Address{"Shanghai", "China"}} p2 := Person{ Name: "Bob", Age: 30, } // 构造函数模式 func NewPerson(name string, age int) *Person { return &amp;Person{ Name: name, Age: age, } } // 匿名字段（嵌入） type Employee struct { Person // 匿名字段 ID int } 函数 函数定义 // 基本语法 func functionName(param1 type1, param2 type2) (returnType1, returnType2) { return value1, value2 } // 命名返回值 func divide(a, b int) (quotient, remainder int) { quotient = a / b remainder = a % b return // 裸return } // 可变参数 func sum(nums ...int) int { total := 0 for _, num := range nums { total += num } return total } 匿名函数和闭包 // 匿名函数 func() { fmt.Println("Hello") }() // 闭包 func counter() func() int { count := 0 return func() int { count++ return count } } c := counter() fmt.Println(c()) // 1 fmt.Println(c()) // 2 defer 语句 func readFile(filename string) error { file, err := os.Open(filename) if err != nil { return err } defer file.Close() // 确保文件关闭 // 读取文件内容 return nil } // defer 的执行顺序是后进先出 (LIFO) func example() { defer fmt.Println("1") defer fmt.Println("2") defer fmt.Println("3") // 输出: 3 2 1 } 高阶函数 // 函数作为参数 func apply(nums []int, fn func(int) int) []int { result := make([]int, len(nums)) for i, v := range nums { result[i] = fn(v) } return result } // 使用 doubled := apply([]int{1, 2, 3}, func(x int) int { return x * 2 }) 方法和接口 方法 type Rectangle struct { Width, Height float64 } // 值接收者 - 不能修改接收者 func (r Rectangle) Area() float64 { return r.Width * r.Height } // 指针接收者 - 可以修改接收者 func (r *Rectangle) Scale(factor float64) { r.Width *= factor r.Height *= factor } // 字符串表示方法 func (r Rectangle) String() string { return fmt.Sprintf("Rectangle(%v, %v)", r.Width, r.Height) } 接口 // 接口定义 type Stringer interface { String() string } type Sizer interface { Size() int } // 接口组合 type Printer interface { Stringer Print() } // 空接口 var x interface{} x = 42 x = "hello" x = []int{1, 2, 3} 类型断言和类型开关 // 类型断言 var i interface{} = "hello" s, ok := i.(string) if ok { fmt.Println("字符串:", s) } // 必须断言（可能panic） s := i.(string) // 类型开关 switch v := i.(type) { case string: fmt.Printf("字符串: %q\n", v) case int: fmt.Printf("整数: %d\n", v) default: fmt.Printf("未知类型: %T\n", v) } 错误处理 错误接口 type error interface { Error() string } // 创建错误 err := errors.New("something went wrong") err := fmt.Errorf("operation failed: %w", originalErr) // 错误包装 错误处理策略 1. 传播错误 func readConfig(filename string) (Config, error) { data, err := ioutil.ReadFile(filename) if err != nil { return Config{}, fmt.Errorf("read config: %w", err) } // 处理配置... return config, nil } 2. 重试机制 func WaitForServer(url string) error { const timeout = 1 * time.Minute deadline := time.Now().Add(timeout) for tries := 0; time.Now().Before(deadline); tries++ { _, err := http.Get(url) if err == nil { return nil } log.Printf("server not responding (%s); retrying...", err) time.Sleep(time.Second << uint(tries)) } return fmt.Errorf("server %s failed to respond after %s", url, timeout) } 3. 记录并继续 if err := doSomething(); err != nil { log.Printf("warning: %v", err) // 继续执行... } 4. 优雅退出 if err := criticalOperation(); err != nil { log.Fatalf("critical error: %v", err) } panic 和 recover func safeDivide(a, b int) (result int, err error) { defer func() { if r := recover(); r != nil { err = fmt.Errorf("panic occurred: %v", r) } }() if b == 0 { panic("division by zero") } result = a / b return } 并发编程 Goroutine // 启动协程 go function() go func() { fmt.Println("Hello from goroutine") }() // 避免主程序过早退出 func main() { go task() time.Sleep(time.Second) // 不推荐 } Channel // 无缓冲通道（同步） ch := make(chan int) // 有缓冲通道（异步） ch := make(chan int, 10) // 发送和接收 ch <- 42 // 发送 value := <-ch // 接收 value, ok := <-ch // 接收，ok表示通道是否关闭 // 关闭通道 close(ch) // 检查通道是否关闭 for value := range ch { fmt.Println(value) } 通道方向 // 只发送通道 func send(ch chan<- int) { ch <- 42 } // 只接收通道 func receive(ch <-chan int) { value := <-ch } select 语句 select { case msg1 := <-ch1: fmt.Println("received from ch1:", msg1) case msg2 := <-ch2: fmt.Println("received from ch2:", msg2) case <-time.After(1 * time.Second): fmt.Println("timeout") default: fmt.Println("no channel ready") } 同步原语 sync.WaitGroup var wg sync.WaitGroup for i := 0; i < 10; i++ { wg.Add(1) go func(i int) { defer wg.Done() fmt.Println("Worker", i) }(i) } wg.Wait() // 等待所有协程完成 sync.Mutex type Counter struct { mu sync.Mutex value int } func (c *Counter) Increment() { c.mu.Lock() defer c.mu.Unlock() c.value++ } func (c *Counter) Value() int { c.mu.Lock() defer c.mu.Unlock() return c.value } sync.RWMutex type SafeMap struct { mu sync.RWMutex m map[string]int } func (sm *SafeMap) Read(key string) int { sm.mu.RLock() defer sm.mu.RUnlock() return sm.m[key] } func (sm *SafeMap) Write(key string, value int) { sm.mu.Lock() defer sm.mu.Unlock() sm.m[key] = value } 并发模式 生产者-消费者 func producer(ch chan<- int) { for i := 0; i < 10; i++ { ch <- i } close(ch) } func consumer(ch <-chan int) { for value := range ch { fmt.Println("consumed:", value) } } func main() { ch := make(chan int) go producer(ch) consumer(ch) } Fan-in/Fan-out // Fan-out: 分发任务到多个协程 func fanOut(input <-chan int, workers int) []<-chan int { outputs := make([]<-chan int, workers) for i := 0; i < workers; i++ { output := make(chan int) outputs[i] = output go func() { defer close(output) for n := range input { output <- process(n) } }() } return outputs } // Fan-in: 合并多个协程的结果 func fanIn(channels ...<-chan int) <-chan int { output := make(chan int) var wg sync.WaitGroup for _, ch := range channels { wg.Add(1) go func(ch <-chan int) { defer wg.Done() for value := range ch { output <- value } }(ch) } go func() { wg.Wait() close(output) }() return output } 输入输出 格式化输出 // Printf 常用格式 %v // 默认格式 %+v // 带字段名的结构体 %#v // Go语法表示 %T // 类型 %t // 布尔值 %d // 十进制整数 %b // 二进制 %o // 八进制 %x // 十六进制（小写） %X // 十六进制（大写） %f // 浮点数 %e // 科学计数法（小写e） %E // 科学计数法（大写E） %s // 字符串 %q // 带引号的字符串 %p // 指针 输入操作 // 标准输入 var name string var age int fmt.Scan(&amp;name, &amp;age) fmt.Scanf("%s %d", &amp;name, &amp;age) // 从字符串读取 input := "Alice 25" fmt.Sscanf(input, "%s %d", &amp;name, &amp;age) // bufio 读取 reader := bufio.NewReader(os.Stdin) line, err := reader.ReadString(&#39;\n&#39;) 文件操作 读取文件 // 一次性读取整个文件 data, err := ioutil.ReadFile("file.txt") if err != nil { log.Fatal(err) } // 逐行读取 file, err := os.Open("file.txt") if err != nil { log.Fatal(err) } defer file.Close() scanner := bufio.NewScanner(file) for scanner.Scan() { line := scanner.Text() fmt.Println(line) } // 使用 bufio.Reader reader := bufio.NewReader(file) for { line, err := reader.ReadString(&#39;\n&#39;) if err == io.EOF { break } if err != nil { log.Fatal(err) } fmt.Print(line) } 写入文件 // 一次性写入 data := []byte("Hello, World!") err := ioutil.WriteFile("output.txt", data, 0644) // 使用 bufio.Writer file, err := os.Create("output.txt") if err != nil { log.Fatal(err) } defer file.Close() writer := bufio.NewWriter(file) writer.WriteString("Hello, World!\n") writer.Flush() // 格式化写入 fmt.Fprintf(file, "Name: %s, Age: %d\n", name, age) 文件复制 func copyFile(src, dst string) error { source, err := os.Open(src) if err != nil { return err } defer source.Close() destination, err := os.Create(dst) if err != nil { return err } defer destination.Close() _, err = io.Copy(destination, source) return err } JSON 处理 type Person struct { Name string `json:"name"` Age int `json:"age"` } // 编码到 JSON person := Person{Name: "Alice", Age: 25} data, err := json.Marshal(person) // 解码 JSON var person Person err := json.Unmarshal(data, &amp;person) // 从文件读取 JSON file, err := os.Open("data.json") defer file.Close() decoder := json.NewDecoder(file) err = decoder.Decode(&amp;person) // 写入 JSON 到文件 file, err := os.Create("output.json") defer file.Close() encoder := json.NewEncoder(file) err = encoder.Encode(person) 包和模块 包的基本概念 // 包声明（每个文件必须有） package main // 导入包 import ( "fmt" "strconv" "net/http" // 别名 str "strings" // 点导入（导入到当前命名空间） . "math" // 仅执行初始化 _ "net/http/pprof" ) Go Modules # 初始化模块 go mod init module-name # 添加依赖 go get github.com/user/repo go get github.com/user/repo@version # 更新依赖 go get -u ./... # 清理未使用的依赖 go mod tidy # 查看依赖 go list -m all # 下载依赖到本地缓存 go mod download go.mod 文件 module example.com/myapp go 1.19 require ( github.com/gin-gonic/gin v1.8.1 gorm.io/gorm v1.23.0 ) replace ( github.com/old/repo => github.com/new/repo v1.0.0 github.com/local/repo => ./local/path ) exclude github.com/broken/repo v1.0.0 包的初始化 var globalVar = initFunction() func init() { // 包初始化代码 // 在main函数之前执行 // 可以有多个init函数 } func initFunction() int { return 42 } 类型系统 类型定义 // 类型别名 type UserID int type Username string // 类型定义 type User struct { ID UserID Name Username } // 接口定义 type Reader interface { Read([]byte) (int, error) } // 函数类型 type Handler func(http.ResponseWriter, *http.Request) 类型断言和转换 // 类型转换（同底层类型） var x int = 42 var y float64 = float64(x) // 类型断言（接口到具体类型） var i interface{} = "hello" s := i.(string) // 安全类型断言 if s, ok := i.(string); ok { fmt.Println(s) } 嵌入和组合 // 结构体嵌入 type Engine struct { Power int } func (e Engine) Start() { fmt.Println("Engine started") } type Car struct { Engine // 嵌入Engine Brand string } // Car 自动获得 Engine 的方法 car := Car{Engine{100}, "Toyota"} car.Start() // 调用 Engine.Start() 反射 基本反射操作 import "reflect" func examine(x interface{}) { v := reflect.ValueOf(x) t := reflect.TypeOf(x) fmt.Printf("Type: %s\n", t) fmt.Printf("Value: %v\n", v) fmt.Printf("Kind: %s\n", v.Kind()) } // 修改值（需要传递指针） func modify(x interface{}) { v := reflect.ValueOf(x).Elem() if v.CanSet() { v.SetInt(100) } } var n int = 42 modify(&amp;n) // n 变为 100 结构体反射 type Person struct { Name string `json:"name" tag:"example"` Age int `json:"age"` } func inspectStruct(x interface{}) { v := reflect.ValueOf(x) t := reflect.TypeOf(x) for i := 0; i < v.NumField(); i++ { field := t.Field(i) value := v.Field(i) fmt.Printf("Field: %s, Type: %s, Value: %v\n", field.Name, field.Type, value) // 获取标签 tag := field.Tag.Get("json") fmt.Printf("JSON tag: %s\n", tag) } } 测试 单元测试 // math.go func Add(a, b int) int { return a + b } // math_test.go package main import "testing" func TestAdd(t *testing.T) { result := Add(2, 3) expected := 5 if result != expected { t.Errorf("Add(2, 3) = %d; want %d", result, expected) } } // 表格驱动测试 func TestAddTable(t *testing.T) { tests := []struct { a, b, expected int }{ {1, 2, 3}, {0, 0, 0}, {-1, 1, 0}, } for _, test := range tests { result := Add(test.a, test.b) if result != test.expected { t.Errorf("Add(%d, %d) = %d; want %d", test.a, test.b, result, test.expected) } } } 基准测试 func BenchmarkAdd(b *testing.B) { for i := 0; i < b.N; i++ { Add(1, 2) } } // 运行基准测试 // go test -bench=. // go test -bench=BenchmarkAdd -benchmem 示例测试 func ExampleAdd() { fmt.Println(Add(1, 2)) // Output: 3 } 工具和命令 常用命令 # 编译和运行 go run main.go go build go build -o myapp go install # 测试 go test go test -v go test -cover go test -bench=. # 格式化代码 go fmt ./... goimports -w . # 代码检查 go vet ./... golint ./... golangci-lint run # 依赖管理 go mod tidy go mod vendor go mod verify # 查看文档 go doc fmt.Println godoc -http=:6060 # 性能分析 go test -cpuprofile=cpu.prof go test -memprofile=mem.prof go tool pprof cpu.prof 编译选项 # 交叉编译 GOOS=linux GOARCH=amd64 go build GOOS=windows GOARCH=amd64 go build GOOS=darwin GOARCH=amd64 go build # 编译优化 go build -ldflags="-s -w" # 去除符号表和调试信息 go build -tags=release # 条件编译 最佳实践 命名规范 包名: 小写，简短，有意义 变量: 驼峰命名法，首字母小写 常量: 驼峰命名法或全大写 函数: 驼峰命名法，首字母大写表示导出 接口: 通常以 -er 结尾（如 Reader, Writer） 代码组织 // 推荐的文件组织方式 myapp/ ├── cmd/ # 应用程序入口 │ └── server/ │ └── main.go ├── internal/ # 私有代码 │ ├── config/ │ ├── handler/ │ └── service/ ├── pkg/ # 公共库代码 ├── api/ # API 定义 ├── web/ # Web 资源 ├── configs/ # 配置文件 ├── scripts/ # 脚本 ├── tests/ # 额外的测试文件 ├── docs/ # 文档 ├── go.mod ├── go.sum └── README.md 性能优化 预分配切片容量 // 好的做法 slice := make([]int, 0, 100) // 避免频繁扩容 for i := 0; i < 100; i++ { slice = append(slice, i) } 字符串拼接 // 低效 var result string for _, s := range strings { result += s } // 高效 var builder strings.Builder for _, s := range strings { builder.WriteString(s) } result := builder.String() 避免不必要的内存分配 // 重用切片 func processData(data []int) { buffer := make([]int, 0, len(data)) // 使用 buffer... buffer = buffer[:0] // 重置长度，保留容量 } 常见陷阱 1. 循环变量捕获 // 错误 for _, item := range items { go func() { fmt.Println(item) // 总是打印最后一个 item }() } // 正确 for _, item := range items { go func(item string) { fmt.Println(item) }(item) } 2. defer 在循环中 // 错误 - defer 会在函数结束时执行，可能导致资源泄漏 func processFiles(files []string) { for _, file := range files { f, err := os.Open(file) if err != nil { continue } defer f.Close() // 在循环中，defer 会累积 // 处理文件... } } // 正确 func processFiles(files []string) { for _, file := range files { func() { f, err := os.Open(file) if err != nil { return } defer f.Close() // 处理文件... }() } } 3. 切片和映射的零值 // 错误 var slice []int slice[0] = 1 // panic: index out of range var m map[string]int m["key"] = 1 // panic: assignment to entry in nil map // 正确 slice := make([]int, 10) slice[0] = 1 m := make(map[string]int) m["key"] = 1 错误处理最佳实践 不要忽略错误 在错误中提供上下文 使用错误包装（Go 1.13+） 定义自定义错误类型 // 自定义错误类型 type ValidationError struct { Field string Value interface{} Tag string } func (e ValidationError) Error() string { return fmt.Sprintf("validation failed on field &#39;%s&#39; with value &#39;%v&#39;", e.Field, e.Value) } 并发安全 使用通道传递数据 使用互斥锁保护共享状态 避免共享内存，通过通信共享 使用 context 控制协程生命周期 常用标准库 字符串处理 (strings) strings.Contains(s, substr) strings.HasPrefix(s, prefix) strings.HasSuffix(s, suffix) strings.Split(s, sep) strings.Join(slice, sep) strings.ToLower(s) strings.ToUpper(s) strings.TrimSpace(s) strings.Replace(s, old, new, n) 时间处理 (time) now := time.Now() time.Sleep(time.Second) future := now.Add(time.Hour) duration := future.Sub(now) // 格式化时间 formatted := now.Format("2006-01-02 15:04:05") // 解析时间 parsed, err := time.Parse("2006-01-02", "2023-01-01") 正则表达式 (regexp) pattern := `\d+` re, err := regexp.Compile(pattern) if err != nil { log.Fatal(err) } matched := re.MatchString("abc123def") matches := re.FindAllString("123 456 789", -1) replaced := re.ReplaceAllString("abc123def", "XXX") HTTP 客户端/服务器 // HTTP 服务器 http.HandleFunc("/", handler) log.Fatal(http.ListenAndServe(":8080", nil)) // HTTP 客户端 resp, err := http.Get("https://api.example.com") if err != nil { log.Fatal(err) } defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) 数据库操作 import "database/sql" import _ "github.com/lib/pq" db, err := sql.Open("postgres", connectionString) defer db.Close() // 查询 rows, err := db.Query("SELECT id, name FROM users") defer rows.Close() for rows.Next() { var id int var name string err := rows.Scan(&amp;id, &amp;name) if err != nil { log.Fatal(err) } fmt.Printf("ID: %d, Name: %s\n", id, name) } // 插入 result, err := db.Exec("INSERT INTO users (name) VALUES ($1)", "Alice") 部署和容器化 Dockerfile # 多阶段构建 FROM golang:1.19-alpine AS builder WORKDIR /app COPY go.mod go.sum ./ RUN go mod download COPY . . RUN CGO_ENABLED=0 GOOS=linux go build -o main . # 最终镜像 FROM alpine:latest RUN apk --no-cache add ca-certificates WORKDIR /root/ COPY --from=builder /app/main . CMD ["./main"] 优雅关闭 func main() { // 创建 HTTP 服务器 srv := &amp;http.Server{ Addr: ":8080", Handler: router, } go func() { if err := srv.ListenAndServe(); err != nil && err != http.ErrServerClosed { log.Fatalf("listen: %s\n", err) } }() // 等待中断信号 quit := make(chan os.Signal, 1) signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM) <-quit log.Println("Shutdown Server ...") // 优雅关闭 ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second) defer cancel() if err := srv.Shutdown(ctx); err != nil { log.Fatal("Server Shutdown:", err) } log.Println("Server exiting") }'><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="golang"><meta property="article:published_time" content="2025-04-04T19:24:42+08:00"><meta property="article:modified_time" content="2025-05-14T15:17:04+08:00"><meta property="og:image" content="https://mlcore-engine.github.io/home/me.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mlcore-engine.github.io/home/me.png"><meta name=twitter:title content="Go 语言基础知识"><meta name=twitter:description content='Go 语言基础知识大全 目录 环境配置 基本数据类型 变量和常量 运算符 控制结构 复合数据类型 函数 方法和接口 错误处理 并发编程 输入输出 包和模块 最佳实践 环境配置 Go 代理设置 go env -w GOPROXY=https://goproxy.cn,direct go env -w GOPROXY=https://gocenter.io,direct 私有库配置 go env -w GOPRIVATE=your-private-repo.com git config --global url."https://username:token@private-repo.com".insteadOf "https://private-repo.com" 基本数据类型 整数类型 有符号整数: int8, int16, int32(rune), int64, int 无符号整数: uint8(byte), uint16, uint32, uint64, uint, uintptr 浮点数和复数 // 浮点数 var f1 float32 = 3.14 var f2 float64 = 3.14159 // 复数 var x complex128 = complex(1, 2) // 1+2i fmt.Println(real(x*y)) // 提取实部 fmt.Println(imag(x*y)) // 提取虚部 布尔类型 var b bool = true // && 的优先级高于 || if &#39;a&#39; <= c && c <= &#39;z&#39; || &#39;A&#39; <= c && c <= &#39;Z&#39; { // 处理字母 } 字符串 // 字符串操作 s := "hello world" len(s) // 字节数 utf8.RuneCountInString(s) // 字符数 // 修改字符串 c := []byte(s) c[0] = &#39;H&#39; s2 := string(c) // 字符串连接（高效方式） var buffer bytes.Buffer buffer.WriteString("hello") buffer.WriteString(" world") result := buffer.String() 变量和常量 变量声明的四种方式 // 1. 短变量声明 s := "hello" // 2. var 声明 var s string // 3. var 声明带初始化 var s = "hello" // 4. var 声明带类型和初始化 var s string = "hello" 常量和 iota const Pi = 3.14159 // iota 枚举器 type Weekday int const ( Sunday Weekday = iota // 0 Monday // 1 Tuesday // 2 Wednesday // 3 Thursday // 4 Friday // 5 Saturday // 6 ) 运算符 算术运算符 + - * / % ++ -- 位运算符 & // AND | // OR ^ // XOR (一元时表示按位取反) &^ // AND NOT (位清除) << // 左移 >> // 右移 // 实例 var x uint8 = 1<<1 | 1<<5 // 00100010 var y uint8 = 1<<1 | 1<<2 // 00000110 fmt.Printf("%08b\n", x&amp;y) // 00000010 fmt.Printf("%08b\n", x|y) // 00100110 fmt.Printf("%08b\n", x^y) // 00100100 fmt.Printf("%08b\n", x&^y) // 00100000 比较运算符 == != < <= > >= 逻辑运算符 && || ! 控制结构 if 语句 if condition { // 代码块 } else if condition2 { // 代码块 } else { // 代码块 } // if 初始化语句 if err := function(); err != nil { return err } switch 语句 // 表达式 switch switch value { case 1: fmt.Println("one") case 2, 3: fmt.Println("two or three") default: fmt.Println("other") } // 类型 switch switch v := x.(type) { case string: fmt.Printf("字符串: %s\n", v) case int: fmt.Printf("整数: %d\n", v) default: fmt.Printf("未知类型\n") } for 循环 // 基本 for 循环 for i := 0; i < 10; i++ { fmt.Println(i) } // while 风格 for condition { // 代码块 } // 无限循环 for { // 代码块 } // range 循环 for index, value := range slice { fmt.Printf("%d: %v\n", index, value) } 复合数据类型 数组 // 数组声明和初始化 var arr [5]int arr2 := [5]int{1, 2, 3, 4, 5} arr3 := [...]int{1, 2, 3} // 编译器推断长度 // 数组是值类型，传递时会复制 func modifyArray(arr *[5]int) { arr[0] = 100 } 切片 (Slice) // 创建切片 s1 := make([]int, 5) // 长度为5 s2 := make([]int, 5, 10) // 长度5，容量10 s3 := []int{1, 2, 3} // 切片操作 s1 = append(s1, 6) // 追加元素 copy(dest, src) // 复制切片 // 切片表达式 s[low:high] // 包含low，不包含high s[low:] // 从low到末尾 s[:high] // 从开始到high s[:] // 整个切片 // 删除元素 func remove(slice []int, i int) []int { copy(slice[i:], slice[i+1:]) return slice[:len(slice)-1] } 映射 (Map) // 创建和初始化 m1 := make(map[string]int) m2 := map[string]int{ "alice": 25, "bob": 30, } // 操作 m1["key"] = value value := m1["key"] delete(m1, "key") // 检查键是否存在 if value, ok := m1["key"]; ok { fmt.Println("存在:", value) } // 遍历 for key, value := range m1 { fmt.Printf("%s: %d\n", key, value) } 结构体 // 定义结构体 type Person struct { Name string Age int addr *Address // 嵌入指针 } type Address struct { City, Country string } // 创建结构体 p1 := Person{"Alice", 25, &amp;Address{"Shanghai", "China"}} p2 := Person{ Name: "Bob", Age: 30, } // 构造函数模式 func NewPerson(name string, age int) *Person { return &amp;Person{ Name: name, Age: age, } } // 匿名字段（嵌入） type Employee struct { Person // 匿名字段 ID int } 函数 函数定义 // 基本语法 func functionName(param1 type1, param2 type2) (returnType1, returnType2) { return value1, value2 } // 命名返回值 func divide(a, b int) (quotient, remainder int) { quotient = a / b remainder = a % b return // 裸return } // 可变参数 func sum(nums ...int) int { total := 0 for _, num := range nums { total += num } return total } 匿名函数和闭包 // 匿名函数 func() { fmt.Println("Hello") }() // 闭包 func counter() func() int { count := 0 return func() int { count++ return count } } c := counter() fmt.Println(c()) // 1 fmt.Println(c()) // 2 defer 语句 func readFile(filename string) error { file, err := os.Open(filename) if err != nil { return err } defer file.Close() // 确保文件关闭 // 读取文件内容 return nil } // defer 的执行顺序是后进先出 (LIFO) func example() { defer fmt.Println("1") defer fmt.Println("2") defer fmt.Println("3") // 输出: 3 2 1 } 高阶函数 // 函数作为参数 func apply(nums []int, fn func(int) int) []int { result := make([]int, len(nums)) for i, v := range nums { result[i] = fn(v) } return result } // 使用 doubled := apply([]int{1, 2, 3}, func(x int) int { return x * 2 }) 方法和接口 方法 type Rectangle struct { Width, Height float64 } // 值接收者 - 不能修改接收者 func (r Rectangle) Area() float64 { return r.Width * r.Height } // 指针接收者 - 可以修改接收者 func (r *Rectangle) Scale(factor float64) { r.Width *= factor r.Height *= factor } // 字符串表示方法 func (r Rectangle) String() string { return fmt.Sprintf("Rectangle(%v, %v)", r.Width, r.Height) } 接口 // 接口定义 type Stringer interface { String() string } type Sizer interface { Size() int } // 接口组合 type Printer interface { Stringer Print() } // 空接口 var x interface{} x = 42 x = "hello" x = []int{1, 2, 3} 类型断言和类型开关 // 类型断言 var i interface{} = "hello" s, ok := i.(string) if ok { fmt.Println("字符串:", s) } // 必须断言（可能panic） s := i.(string) // 类型开关 switch v := i.(type) { case string: fmt.Printf("字符串: %q\n", v) case int: fmt.Printf("整数: %d\n", v) default: fmt.Printf("未知类型: %T\n", v) } 错误处理 错误接口 type error interface { Error() string } // 创建错误 err := errors.New("something went wrong") err := fmt.Errorf("operation failed: %w", originalErr) // 错误包装 错误处理策略 1. 传播错误 func readConfig(filename string) (Config, error) { data, err := ioutil.ReadFile(filename) if err != nil { return Config{}, fmt.Errorf("read config: %w", err) } // 处理配置... return config, nil } 2. 重试机制 func WaitForServer(url string) error { const timeout = 1 * time.Minute deadline := time.Now().Add(timeout) for tries := 0; time.Now().Before(deadline); tries++ { _, err := http.Get(url) if err == nil { return nil } log.Printf("server not responding (%s); retrying...", err) time.Sleep(time.Second << uint(tries)) } return fmt.Errorf("server %s failed to respond after %s", url, timeout) } 3. 记录并继续 if err := doSomething(); err != nil { log.Printf("warning: %v", err) // 继续执行... } 4. 优雅退出 if err := criticalOperation(); err != nil { log.Fatalf("critical error: %v", err) } panic 和 recover func safeDivide(a, b int) (result int, err error) { defer func() { if r := recover(); r != nil { err = fmt.Errorf("panic occurred: %v", r) } }() if b == 0 { panic("division by zero") } result = a / b return } 并发编程 Goroutine // 启动协程 go function() go func() { fmt.Println("Hello from goroutine") }() // 避免主程序过早退出 func main() { go task() time.Sleep(time.Second) // 不推荐 } Channel // 无缓冲通道（同步） ch := make(chan int) // 有缓冲通道（异步） ch := make(chan int, 10) // 发送和接收 ch <- 42 // 发送 value := <-ch // 接收 value, ok := <-ch // 接收，ok表示通道是否关闭 // 关闭通道 close(ch) // 检查通道是否关闭 for value := range ch { fmt.Println(value) } 通道方向 // 只发送通道 func send(ch chan<- int) { ch <- 42 } // 只接收通道 func receive(ch <-chan int) { value := <-ch } select 语句 select { case msg1 := <-ch1: fmt.Println("received from ch1:", msg1) case msg2 := <-ch2: fmt.Println("received from ch2:", msg2) case <-time.After(1 * time.Second): fmt.Println("timeout") default: fmt.Println("no channel ready") } 同步原语 sync.WaitGroup var wg sync.WaitGroup for i := 0; i < 10; i++ { wg.Add(1) go func(i int) { defer wg.Done() fmt.Println("Worker", i) }(i) } wg.Wait() // 等待所有协程完成 sync.Mutex type Counter struct { mu sync.Mutex value int } func (c *Counter) Increment() { c.mu.Lock() defer c.mu.Unlock() c.value++ } func (c *Counter) Value() int { c.mu.Lock() defer c.mu.Unlock() return c.value } sync.RWMutex type SafeMap struct { mu sync.RWMutex m map[string]int } func (sm *SafeMap) Read(key string) int { sm.mu.RLock() defer sm.mu.RUnlock() return sm.m[key] } func (sm *SafeMap) Write(key string, value int) { sm.mu.Lock() defer sm.mu.Unlock() sm.m[key] = value } 并发模式 生产者-消费者 func producer(ch chan<- int) { for i := 0; i < 10; i++ { ch <- i } close(ch) } func consumer(ch <-chan int) { for value := range ch { fmt.Println("consumed:", value) } } func main() { ch := make(chan int) go producer(ch) consumer(ch) } Fan-in/Fan-out // Fan-out: 分发任务到多个协程 func fanOut(input <-chan int, workers int) []<-chan int { outputs := make([]<-chan int, workers) for i := 0; i < workers; i++ { output := make(chan int) outputs[i] = output go func() { defer close(output) for n := range input { output <- process(n) } }() } return outputs } // Fan-in: 合并多个协程的结果 func fanIn(channels ...<-chan int) <-chan int { output := make(chan int) var wg sync.WaitGroup for _, ch := range channels { wg.Add(1) go func(ch <-chan int) { defer wg.Done() for value := range ch { output <- value } }(ch) } go func() { wg.Wait() close(output) }() return output } 输入输出 格式化输出 // Printf 常用格式 %v // 默认格式 %+v // 带字段名的结构体 %#v // Go语法表示 %T // 类型 %t // 布尔值 %d // 十进制整数 %b // 二进制 %o // 八进制 %x // 十六进制（小写） %X // 十六进制（大写） %f // 浮点数 %e // 科学计数法（小写e） %E // 科学计数法（大写E） %s // 字符串 %q // 带引号的字符串 %p // 指针 输入操作 // 标准输入 var name string var age int fmt.Scan(&amp;name, &amp;age) fmt.Scanf("%s %d", &amp;name, &amp;age) // 从字符串读取 input := "Alice 25" fmt.Sscanf(input, "%s %d", &amp;name, &amp;age) // bufio 读取 reader := bufio.NewReader(os.Stdin) line, err := reader.ReadString(&#39;\n&#39;) 文件操作 读取文件 // 一次性读取整个文件 data, err := ioutil.ReadFile("file.txt") if err != nil { log.Fatal(err) } // 逐行读取 file, err := os.Open("file.txt") if err != nil { log.Fatal(err) } defer file.Close() scanner := bufio.NewScanner(file) for scanner.Scan() { line := scanner.Text() fmt.Println(line) } // 使用 bufio.Reader reader := bufio.NewReader(file) for { line, err := reader.ReadString(&#39;\n&#39;) if err == io.EOF { break } if err != nil { log.Fatal(err) } fmt.Print(line) } 写入文件 // 一次性写入 data := []byte("Hello, World!") err := ioutil.WriteFile("output.txt", data, 0644) // 使用 bufio.Writer file, err := os.Create("output.txt") if err != nil { log.Fatal(err) } defer file.Close() writer := bufio.NewWriter(file) writer.WriteString("Hello, World!\n") writer.Flush() // 格式化写入 fmt.Fprintf(file, "Name: %s, Age: %d\n", name, age) 文件复制 func copyFile(src, dst string) error { source, err := os.Open(src) if err != nil { return err } defer source.Close() destination, err := os.Create(dst) if err != nil { return err } defer destination.Close() _, err = io.Copy(destination, source) return err } JSON 处理 type Person struct { Name string `json:"name"` Age int `json:"age"` } // 编码到 JSON person := Person{Name: "Alice", Age: 25} data, err := json.Marshal(person) // 解码 JSON var person Person err := json.Unmarshal(data, &amp;person) // 从文件读取 JSON file, err := os.Open("data.json") defer file.Close() decoder := json.NewDecoder(file) err = decoder.Decode(&amp;person) // 写入 JSON 到文件 file, err := os.Create("output.json") defer file.Close() encoder := json.NewEncoder(file) err = encoder.Encode(person) 包和模块 包的基本概念 // 包声明（每个文件必须有） package main // 导入包 import ( "fmt" "strconv" "net/http" // 别名 str "strings" // 点导入（导入到当前命名空间） . "math" // 仅执行初始化 _ "net/http/pprof" ) Go Modules # 初始化模块 go mod init module-name # 添加依赖 go get github.com/user/repo go get github.com/user/repo@version # 更新依赖 go get -u ./... # 清理未使用的依赖 go mod tidy # 查看依赖 go list -m all # 下载依赖到本地缓存 go mod download go.mod 文件 module example.com/myapp go 1.19 require ( github.com/gin-gonic/gin v1.8.1 gorm.io/gorm v1.23.0 ) replace ( github.com/old/repo => github.com/new/repo v1.0.0 github.com/local/repo => ./local/path ) exclude github.com/broken/repo v1.0.0 包的初始化 var globalVar = initFunction() func init() { // 包初始化代码 // 在main函数之前执行 // 可以有多个init函数 } func initFunction() int { return 42 } 类型系统 类型定义 // 类型别名 type UserID int type Username string // 类型定义 type User struct { ID UserID Name Username } // 接口定义 type Reader interface { Read([]byte) (int, error) } // 函数类型 type Handler func(http.ResponseWriter, *http.Request) 类型断言和转换 // 类型转换（同底层类型） var x int = 42 var y float64 = float64(x) // 类型断言（接口到具体类型） var i interface{} = "hello" s := i.(string) // 安全类型断言 if s, ok := i.(string); ok { fmt.Println(s) } 嵌入和组合 // 结构体嵌入 type Engine struct { Power int } func (e Engine) Start() { fmt.Println("Engine started") } type Car struct { Engine // 嵌入Engine Brand string } // Car 自动获得 Engine 的方法 car := Car{Engine{100}, "Toyota"} car.Start() // 调用 Engine.Start() 反射 基本反射操作 import "reflect" func examine(x interface{}) { v := reflect.ValueOf(x) t := reflect.TypeOf(x) fmt.Printf("Type: %s\n", t) fmt.Printf("Value: %v\n", v) fmt.Printf("Kind: %s\n", v.Kind()) } // 修改值（需要传递指针） func modify(x interface{}) { v := reflect.ValueOf(x).Elem() if v.CanSet() { v.SetInt(100) } } var n int = 42 modify(&amp;n) // n 变为 100 结构体反射 type Person struct { Name string `json:"name" tag:"example"` Age int `json:"age"` } func inspectStruct(x interface{}) { v := reflect.ValueOf(x) t := reflect.TypeOf(x) for i := 0; i < v.NumField(); i++ { field := t.Field(i) value := v.Field(i) fmt.Printf("Field: %s, Type: %s, Value: %v\n", field.Name, field.Type, value) // 获取标签 tag := field.Tag.Get("json") fmt.Printf("JSON tag: %s\n", tag) } } 测试 单元测试 // math.go func Add(a, b int) int { return a + b } // math_test.go package main import "testing" func TestAdd(t *testing.T) { result := Add(2, 3) expected := 5 if result != expected { t.Errorf("Add(2, 3) = %d; want %d", result, expected) } } // 表格驱动测试 func TestAddTable(t *testing.T) { tests := []struct { a, b, expected int }{ {1, 2, 3}, {0, 0, 0}, {-1, 1, 0}, } for _, test := range tests { result := Add(test.a, test.b) if result != test.expected { t.Errorf("Add(%d, %d) = %d; want %d", test.a, test.b, result, test.expected) } } } 基准测试 func BenchmarkAdd(b *testing.B) { for i := 0; i < b.N; i++ { Add(1, 2) } } // 运行基准测试 // go test -bench=. // go test -bench=BenchmarkAdd -benchmem 示例测试 func ExampleAdd() { fmt.Println(Add(1, 2)) // Output: 3 } 工具和命令 常用命令 # 编译和运行 go run main.go go build go build -o myapp go install # 测试 go test go test -v go test -cover go test -bench=. # 格式化代码 go fmt ./... goimports -w . # 代码检查 go vet ./... golint ./... golangci-lint run # 依赖管理 go mod tidy go mod vendor go mod verify # 查看文档 go doc fmt.Println godoc -http=:6060 # 性能分析 go test -cpuprofile=cpu.prof go test -memprofile=mem.prof go tool pprof cpu.prof 编译选项 # 交叉编译 GOOS=linux GOARCH=amd64 go build GOOS=windows GOARCH=amd64 go build GOOS=darwin GOARCH=amd64 go build # 编译优化 go build -ldflags="-s -w" # 去除符号表和调试信息 go build -tags=release # 条件编译 最佳实践 命名规范 包名: 小写，简短，有意义 变量: 驼峰命名法，首字母小写 常量: 驼峰命名法或全大写 函数: 驼峰命名法，首字母大写表示导出 接口: 通常以 -er 结尾（如 Reader, Writer） 代码组织 // 推荐的文件组织方式 myapp/ ├── cmd/ # 应用程序入口 │ └── server/ │ └── main.go ├── internal/ # 私有代码 │ ├── config/ │ ├── handler/ │ └── service/ ├── pkg/ # 公共库代码 ├── api/ # API 定义 ├── web/ # Web 资源 ├── configs/ # 配置文件 ├── scripts/ # 脚本 ├── tests/ # 额外的测试文件 ├── docs/ # 文档 ├── go.mod ├── go.sum └── README.md 性能优化 预分配切片容量 // 好的做法 slice := make([]int, 0, 100) // 避免频繁扩容 for i := 0; i < 100; i++ { slice = append(slice, i) } 字符串拼接 // 低效 var result string for _, s := range strings { result += s } // 高效 var builder strings.Builder for _, s := range strings { builder.WriteString(s) } result := builder.String() 避免不必要的内存分配 // 重用切片 func processData(data []int) { buffer := make([]int, 0, len(data)) // 使用 buffer... buffer = buffer[:0] // 重置长度，保留容量 } 常见陷阱 1. 循环变量捕获 // 错误 for _, item := range items { go func() { fmt.Println(item) // 总是打印最后一个 item }() } // 正确 for _, item := range items { go func(item string) { fmt.Println(item) }(item) } 2. defer 在循环中 // 错误 - defer 会在函数结束时执行，可能导致资源泄漏 func processFiles(files []string) { for _, file := range files { f, err := os.Open(file) if err != nil { continue } defer f.Close() // 在循环中，defer 会累积 // 处理文件... } } // 正确 func processFiles(files []string) { for _, file := range files { func() { f, err := os.Open(file) if err != nil { return } defer f.Close() // 处理文件... }() } } 3. 切片和映射的零值 // 错误 var slice []int slice[0] = 1 // panic: index out of range var m map[string]int m["key"] = 1 // panic: assignment to entry in nil map // 正确 slice := make([]int, 10) slice[0] = 1 m := make(map[string]int) m["key"] = 1 错误处理最佳实践 不要忽略错误 在错误中提供上下文 使用错误包装（Go 1.13+） 定义自定义错误类型 // 自定义错误类型 type ValidationError struct { Field string Value interface{} Tag string } func (e ValidationError) Error() string { return fmt.Sprintf("validation failed on field &#39;%s&#39; with value &#39;%v&#39;", e.Field, e.Value) } 并发安全 使用通道传递数据 使用互斥锁保护共享状态 避免共享内存，通过通信共享 使用 context 控制协程生命周期 常用标准库 字符串处理 (strings) strings.Contains(s, substr) strings.HasPrefix(s, prefix) strings.HasSuffix(s, suffix) strings.Split(s, sep) strings.Join(slice, sep) strings.ToLower(s) strings.ToUpper(s) strings.TrimSpace(s) strings.Replace(s, old, new, n) 时间处理 (time) now := time.Now() time.Sleep(time.Second) future := now.Add(time.Hour) duration := future.Sub(now) // 格式化时间 formatted := now.Format("2006-01-02 15:04:05") // 解析时间 parsed, err := time.Parse("2006-01-02", "2023-01-01") 正则表达式 (regexp) pattern := `\d+` re, err := regexp.Compile(pattern) if err != nil { log.Fatal(err) } matched := re.MatchString("abc123def") matches := re.FindAllString("123 456 789", -1) replaced := re.ReplaceAllString("abc123def", "XXX") HTTP 客户端/服务器 // HTTP 服务器 http.HandleFunc("/", handler) log.Fatal(http.ListenAndServe(":8080", nil)) // HTTP 客户端 resp, err := http.Get("https://api.example.com") if err != nil { log.Fatal(err) } defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) 数据库操作 import "database/sql" import _ "github.com/lib/pq" db, err := sql.Open("postgres", connectionString) defer db.Close() // 查询 rows, err := db.Query("SELECT id, name FROM users") defer rows.Close() for rows.Next() { var id int var name string err := rows.Scan(&amp;id, &amp;name) if err != nil { log.Fatal(err) } fmt.Printf("ID: %d, Name: %s\n", id, name) } // 插入 result, err := db.Exec("INSERT INTO users (name) VALUES ($1)", "Alice") 部署和容器化 Dockerfile # 多阶段构建 FROM golang:1.19-alpine AS builder WORKDIR /app COPY go.mod go.sum ./ RUN go mod download COPY . . RUN CGO_ENABLED=0 GOOS=linux go build -o main . # 最终镜像 FROM alpine:latest RUN apk --no-cache add ca-certificates WORKDIR /root/ COPY --from=builder /app/main . CMD ["./main"] 优雅关闭 func main() { // 创建 HTTP 服务器 srv := &amp;http.Server{ Addr: ":8080", Handler: router, } go func() { if err := srv.ListenAndServe(); err != nil && err != http.ErrServerClosed { log.Fatalf("listen: %s\n", err) } }() // 等待中断信号 quit := make(chan os.Signal, 1) signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM) <-quit log.Println("Shutdown Server ...") // 优雅关闭 ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second) defer cancel() if err := srv.Shutdown(ctx); err != nil { log.Fatal("Server Shutdown:", err) } log.Println("Server exiting") }'><meta itemprop=name content="Go 语言基础知识"><meta itemprop=description content='Go 语言基础知识大全 目录 环境配置 基本数据类型 变量和常量 运算符 控制结构 复合数据类型 函数 方法和接口 错误处理 并发编程 输入输出 包和模块 最佳实践 环境配置 Go 代理设置 go env -w GOPROXY=https://goproxy.cn,direct go env -w GOPROXY=https://gocenter.io,direct 私有库配置 go env -w GOPRIVATE=your-private-repo.com git config --global url."https://username:token@private-repo.com".insteadOf "https://private-repo.com" 基本数据类型 整数类型 有符号整数: int8, int16, int32(rune), int64, int 无符号整数: uint8(byte), uint16, uint32, uint64, uint, uintptr 浮点数和复数 // 浮点数 var f1 float32 = 3.14 var f2 float64 = 3.14159 // 复数 var x complex128 = complex(1, 2) // 1+2i fmt.Println(real(x*y)) // 提取实部 fmt.Println(imag(x*y)) // 提取虚部 布尔类型 var b bool = true // && 的优先级高于 || if &#39;a&#39; <= c && c <= &#39;z&#39; || &#39;A&#39; <= c && c <= &#39;Z&#39; { // 处理字母 } 字符串 // 字符串操作 s := "hello world" len(s) // 字节数 utf8.RuneCountInString(s) // 字符数 // 修改字符串 c := []byte(s) c[0] = &#39;H&#39; s2 := string(c) // 字符串连接（高效方式） var buffer bytes.Buffer buffer.WriteString("hello") buffer.WriteString(" world") result := buffer.String() 变量和常量 变量声明的四种方式 // 1. 短变量声明 s := "hello" // 2. var 声明 var s string // 3. var 声明带初始化 var s = "hello" // 4. var 声明带类型和初始化 var s string = "hello" 常量和 iota const Pi = 3.14159 // iota 枚举器 type Weekday int const ( Sunday Weekday = iota // 0 Monday // 1 Tuesday // 2 Wednesday // 3 Thursday // 4 Friday // 5 Saturday // 6 ) 运算符 算术运算符 + - * / % ++ -- 位运算符 & // AND | // OR ^ // XOR (一元时表示按位取反) &^ // AND NOT (位清除) << // 左移 >> // 右移 // 实例 var x uint8 = 1<<1 | 1<<5 // 00100010 var y uint8 = 1<<1 | 1<<2 // 00000110 fmt.Printf("%08b\n", x&amp;y) // 00000010 fmt.Printf("%08b\n", x|y) // 00100110 fmt.Printf("%08b\n", x^y) // 00100100 fmt.Printf("%08b\n", x&^y) // 00100000 比较运算符 == != < <= > >= 逻辑运算符 && || ! 控制结构 if 语句 if condition { // 代码块 } else if condition2 { // 代码块 } else { // 代码块 } // if 初始化语句 if err := function(); err != nil { return err } switch 语句 // 表达式 switch switch value { case 1: fmt.Println("one") case 2, 3: fmt.Println("two or three") default: fmt.Println("other") } // 类型 switch switch v := x.(type) { case string: fmt.Printf("字符串: %s\n", v) case int: fmt.Printf("整数: %d\n", v) default: fmt.Printf("未知类型\n") } for 循环 // 基本 for 循环 for i := 0; i < 10; i++ { fmt.Println(i) } // while 风格 for condition { // 代码块 } // 无限循环 for { // 代码块 } // range 循环 for index, value := range slice { fmt.Printf("%d: %v\n", index, value) } 复合数据类型 数组 // 数组声明和初始化 var arr [5]int arr2 := [5]int{1, 2, 3, 4, 5} arr3 := [...]int{1, 2, 3} // 编译器推断长度 // 数组是值类型，传递时会复制 func modifyArray(arr *[5]int) { arr[0] = 100 } 切片 (Slice) // 创建切片 s1 := make([]int, 5) // 长度为5 s2 := make([]int, 5, 10) // 长度5，容量10 s3 := []int{1, 2, 3} // 切片操作 s1 = append(s1, 6) // 追加元素 copy(dest, src) // 复制切片 // 切片表达式 s[low:high] // 包含low，不包含high s[low:] // 从low到末尾 s[:high] // 从开始到high s[:] // 整个切片 // 删除元素 func remove(slice []int, i int) []int { copy(slice[i:], slice[i+1:]) return slice[:len(slice)-1] } 映射 (Map) // 创建和初始化 m1 := make(map[string]int) m2 := map[string]int{ "alice": 25, "bob": 30, } // 操作 m1["key"] = value value := m1["key"] delete(m1, "key") // 检查键是否存在 if value, ok := m1["key"]; ok { fmt.Println("存在:", value) } // 遍历 for key, value := range m1 { fmt.Printf("%s: %d\n", key, value) } 结构体 // 定义结构体 type Person struct { Name string Age int addr *Address // 嵌入指针 } type Address struct { City, Country string } // 创建结构体 p1 := Person{"Alice", 25, &amp;Address{"Shanghai", "China"}} p2 := Person{ Name: "Bob", Age: 30, } // 构造函数模式 func NewPerson(name string, age int) *Person { return &amp;Person{ Name: name, Age: age, } } // 匿名字段（嵌入） type Employee struct { Person // 匿名字段 ID int } 函数 函数定义 // 基本语法 func functionName(param1 type1, param2 type2) (returnType1, returnType2) { return value1, value2 } // 命名返回值 func divide(a, b int) (quotient, remainder int) { quotient = a / b remainder = a % b return // 裸return } // 可变参数 func sum(nums ...int) int { total := 0 for _, num := range nums { total += num } return total } 匿名函数和闭包 // 匿名函数 func() { fmt.Println("Hello") }() // 闭包 func counter() func() int { count := 0 return func() int { count++ return count } } c := counter() fmt.Println(c()) // 1 fmt.Println(c()) // 2 defer 语句 func readFile(filename string) error { file, err := os.Open(filename) if err != nil { return err } defer file.Close() // 确保文件关闭 // 读取文件内容 return nil } // defer 的执行顺序是后进先出 (LIFO) func example() { defer fmt.Println("1") defer fmt.Println("2") defer fmt.Println("3") // 输出: 3 2 1 } 高阶函数 // 函数作为参数 func apply(nums []int, fn func(int) int) []int { result := make([]int, len(nums)) for i, v := range nums { result[i] = fn(v) } return result } // 使用 doubled := apply([]int{1, 2, 3}, func(x int) int { return x * 2 }) 方法和接口 方法 type Rectangle struct { Width, Height float64 } // 值接收者 - 不能修改接收者 func (r Rectangle) Area() float64 { return r.Width * r.Height } // 指针接收者 - 可以修改接收者 func (r *Rectangle) Scale(factor float64) { r.Width *= factor r.Height *= factor } // 字符串表示方法 func (r Rectangle) String() string { return fmt.Sprintf("Rectangle(%v, %v)", r.Width, r.Height) } 接口 // 接口定义 type Stringer interface { String() string } type Sizer interface { Size() int } // 接口组合 type Printer interface { Stringer Print() } // 空接口 var x interface{} x = 42 x = "hello" x = []int{1, 2, 3} 类型断言和类型开关 // 类型断言 var i interface{} = "hello" s, ok := i.(string) if ok { fmt.Println("字符串:", s) } // 必须断言（可能panic） s := i.(string) // 类型开关 switch v := i.(type) { case string: fmt.Printf("字符串: %q\n", v) case int: fmt.Printf("整数: %d\n", v) default: fmt.Printf("未知类型: %T\n", v) } 错误处理 错误接口 type error interface { Error() string } // 创建错误 err := errors.New("something went wrong") err := fmt.Errorf("operation failed: %w", originalErr) // 错误包装 错误处理策略 1. 传播错误 func readConfig(filename string) (Config, error) { data, err := ioutil.ReadFile(filename) if err != nil { return Config{}, fmt.Errorf("read config: %w", err) } // 处理配置... return config, nil } 2. 重试机制 func WaitForServer(url string) error { const timeout = 1 * time.Minute deadline := time.Now().Add(timeout) for tries := 0; time.Now().Before(deadline); tries++ { _, err := http.Get(url) if err == nil { return nil } log.Printf("server not responding (%s); retrying...", err) time.Sleep(time.Second << uint(tries)) } return fmt.Errorf("server %s failed to respond after %s", url, timeout) } 3. 记录并继续 if err := doSomething(); err != nil { log.Printf("warning: %v", err) // 继续执行... } 4. 优雅退出 if err := criticalOperation(); err != nil { log.Fatalf("critical error: %v", err) } panic 和 recover func safeDivide(a, b int) (result int, err error) { defer func() { if r := recover(); r != nil { err = fmt.Errorf("panic occurred: %v", r) } }() if b == 0 { panic("division by zero") } result = a / b return } 并发编程 Goroutine // 启动协程 go function() go func() { fmt.Println("Hello from goroutine") }() // 避免主程序过早退出 func main() { go task() time.Sleep(time.Second) // 不推荐 } Channel // 无缓冲通道（同步） ch := make(chan int) // 有缓冲通道（异步） ch := make(chan int, 10) // 发送和接收 ch <- 42 // 发送 value := <-ch // 接收 value, ok := <-ch // 接收，ok表示通道是否关闭 // 关闭通道 close(ch) // 检查通道是否关闭 for value := range ch { fmt.Println(value) } 通道方向 // 只发送通道 func send(ch chan<- int) { ch <- 42 } // 只接收通道 func receive(ch <-chan int) { value := <-ch } select 语句 select { case msg1 := <-ch1: fmt.Println("received from ch1:", msg1) case msg2 := <-ch2: fmt.Println("received from ch2:", msg2) case <-time.After(1 * time.Second): fmt.Println("timeout") default: fmt.Println("no channel ready") } 同步原语 sync.WaitGroup var wg sync.WaitGroup for i := 0; i < 10; i++ { wg.Add(1) go func(i int) { defer wg.Done() fmt.Println("Worker", i) }(i) } wg.Wait() // 等待所有协程完成 sync.Mutex type Counter struct { mu sync.Mutex value int } func (c *Counter) Increment() { c.mu.Lock() defer c.mu.Unlock() c.value++ } func (c *Counter) Value() int { c.mu.Lock() defer c.mu.Unlock() return c.value } sync.RWMutex type SafeMap struct { mu sync.RWMutex m map[string]int } func (sm *SafeMap) Read(key string) int { sm.mu.RLock() defer sm.mu.RUnlock() return sm.m[key] } func (sm *SafeMap) Write(key string, value int) { sm.mu.Lock() defer sm.mu.Unlock() sm.m[key] = value } 并发模式 生产者-消费者 func producer(ch chan<- int) { for i := 0; i < 10; i++ { ch <- i } close(ch) } func consumer(ch <-chan int) { for value := range ch { fmt.Println("consumed:", value) } } func main() { ch := make(chan int) go producer(ch) consumer(ch) } Fan-in/Fan-out // Fan-out: 分发任务到多个协程 func fanOut(input <-chan int, workers int) []<-chan int { outputs := make([]<-chan int, workers) for i := 0; i < workers; i++ { output := make(chan int) outputs[i] = output go func() { defer close(output) for n := range input { output <- process(n) } }() } return outputs } // Fan-in: 合并多个协程的结果 func fanIn(channels ...<-chan int) <-chan int { output := make(chan int) var wg sync.WaitGroup for _, ch := range channels { wg.Add(1) go func(ch <-chan int) { defer wg.Done() for value := range ch { output <- value } }(ch) } go func() { wg.Wait() close(output) }() return output } 输入输出 格式化输出 // Printf 常用格式 %v // 默认格式 %+v // 带字段名的结构体 %#v // Go语法表示 %T // 类型 %t // 布尔值 %d // 十进制整数 %b // 二进制 %o // 八进制 %x // 十六进制（小写） %X // 十六进制（大写） %f // 浮点数 %e // 科学计数法（小写e） %E // 科学计数法（大写E） %s // 字符串 %q // 带引号的字符串 %p // 指针 输入操作 // 标准输入 var name string var age int fmt.Scan(&amp;name, &amp;age) fmt.Scanf("%s %d", &amp;name, &amp;age) // 从字符串读取 input := "Alice 25" fmt.Sscanf(input, "%s %d", &amp;name, &amp;age) // bufio 读取 reader := bufio.NewReader(os.Stdin) line, err := reader.ReadString(&#39;\n&#39;) 文件操作 读取文件 // 一次性读取整个文件 data, err := ioutil.ReadFile("file.txt") if err != nil { log.Fatal(err) } // 逐行读取 file, err := os.Open("file.txt") if err != nil { log.Fatal(err) } defer file.Close() scanner := bufio.NewScanner(file) for scanner.Scan() { line := scanner.Text() fmt.Println(line) } // 使用 bufio.Reader reader := bufio.NewReader(file) for { line, err := reader.ReadString(&#39;\n&#39;) if err == io.EOF { break } if err != nil { log.Fatal(err) } fmt.Print(line) } 写入文件 // 一次性写入 data := []byte("Hello, World!") err := ioutil.WriteFile("output.txt", data, 0644) // 使用 bufio.Writer file, err := os.Create("output.txt") if err != nil { log.Fatal(err) } defer file.Close() writer := bufio.NewWriter(file) writer.WriteString("Hello, World!\n") writer.Flush() // 格式化写入 fmt.Fprintf(file, "Name: %s, Age: %d\n", name, age) 文件复制 func copyFile(src, dst string) error { source, err := os.Open(src) if err != nil { return err } defer source.Close() destination, err := os.Create(dst) if err != nil { return err } defer destination.Close() _, err = io.Copy(destination, source) return err } JSON 处理 type Person struct { Name string `json:"name"` Age int `json:"age"` } // 编码到 JSON person := Person{Name: "Alice", Age: 25} data, err := json.Marshal(person) // 解码 JSON var person Person err := json.Unmarshal(data, &amp;person) // 从文件读取 JSON file, err := os.Open("data.json") defer file.Close() decoder := json.NewDecoder(file) err = decoder.Decode(&amp;person) // 写入 JSON 到文件 file, err := os.Create("output.json") defer file.Close() encoder := json.NewEncoder(file) err = encoder.Encode(person) 包和模块 包的基本概念 // 包声明（每个文件必须有） package main // 导入包 import ( "fmt" "strconv" "net/http" // 别名 str "strings" // 点导入（导入到当前命名空间） . "math" // 仅执行初始化 _ "net/http/pprof" ) Go Modules # 初始化模块 go mod init module-name # 添加依赖 go get github.com/user/repo go get github.com/user/repo@version # 更新依赖 go get -u ./... # 清理未使用的依赖 go mod tidy # 查看依赖 go list -m all # 下载依赖到本地缓存 go mod download go.mod 文件 module example.com/myapp go 1.19 require ( github.com/gin-gonic/gin v1.8.1 gorm.io/gorm v1.23.0 ) replace ( github.com/old/repo => github.com/new/repo v1.0.0 github.com/local/repo => ./local/path ) exclude github.com/broken/repo v1.0.0 包的初始化 var globalVar = initFunction() func init() { // 包初始化代码 // 在main函数之前执行 // 可以有多个init函数 } func initFunction() int { return 42 } 类型系统 类型定义 // 类型别名 type UserID int type Username string // 类型定义 type User struct { ID UserID Name Username } // 接口定义 type Reader interface { Read([]byte) (int, error) } // 函数类型 type Handler func(http.ResponseWriter, *http.Request) 类型断言和转换 // 类型转换（同底层类型） var x int = 42 var y float64 = float64(x) // 类型断言（接口到具体类型） var i interface{} = "hello" s := i.(string) // 安全类型断言 if s, ok := i.(string); ok { fmt.Println(s) } 嵌入和组合 // 结构体嵌入 type Engine struct { Power int } func (e Engine) Start() { fmt.Println("Engine started") } type Car struct { Engine // 嵌入Engine Brand string } // Car 自动获得 Engine 的方法 car := Car{Engine{100}, "Toyota"} car.Start() // 调用 Engine.Start() 反射 基本反射操作 import "reflect" func examine(x interface{}) { v := reflect.ValueOf(x) t := reflect.TypeOf(x) fmt.Printf("Type: %s\n", t) fmt.Printf("Value: %v\n", v) fmt.Printf("Kind: %s\n", v.Kind()) } // 修改值（需要传递指针） func modify(x interface{}) { v := reflect.ValueOf(x).Elem() if v.CanSet() { v.SetInt(100) } } var n int = 42 modify(&amp;n) // n 变为 100 结构体反射 type Person struct { Name string `json:"name" tag:"example"` Age int `json:"age"` } func inspectStruct(x interface{}) { v := reflect.ValueOf(x) t := reflect.TypeOf(x) for i := 0; i < v.NumField(); i++ { field := t.Field(i) value := v.Field(i) fmt.Printf("Field: %s, Type: %s, Value: %v\n", field.Name, field.Type, value) // 获取标签 tag := field.Tag.Get("json") fmt.Printf("JSON tag: %s\n", tag) } } 测试 单元测试 // math.go func Add(a, b int) int { return a + b } // math_test.go package main import "testing" func TestAdd(t *testing.T) { result := Add(2, 3) expected := 5 if result != expected { t.Errorf("Add(2, 3) = %d; want %d", result, expected) } } // 表格驱动测试 func TestAddTable(t *testing.T) { tests := []struct { a, b, expected int }{ {1, 2, 3}, {0, 0, 0}, {-1, 1, 0}, } for _, test := range tests { result := Add(test.a, test.b) if result != test.expected { t.Errorf("Add(%d, %d) = %d; want %d", test.a, test.b, result, test.expected) } } } 基准测试 func BenchmarkAdd(b *testing.B) { for i := 0; i < b.N; i++ { Add(1, 2) } } // 运行基准测试 // go test -bench=. // go test -bench=BenchmarkAdd -benchmem 示例测试 func ExampleAdd() { fmt.Println(Add(1, 2)) // Output: 3 } 工具和命令 常用命令 # 编译和运行 go run main.go go build go build -o myapp go install # 测试 go test go test -v go test -cover go test -bench=. # 格式化代码 go fmt ./... goimports -w . # 代码检查 go vet ./... golint ./... golangci-lint run # 依赖管理 go mod tidy go mod vendor go mod verify # 查看文档 go doc fmt.Println godoc -http=:6060 # 性能分析 go test -cpuprofile=cpu.prof go test -memprofile=mem.prof go tool pprof cpu.prof 编译选项 # 交叉编译 GOOS=linux GOARCH=amd64 go build GOOS=windows GOARCH=amd64 go build GOOS=darwin GOARCH=amd64 go build # 编译优化 go build -ldflags="-s -w" # 去除符号表和调试信息 go build -tags=release # 条件编译 最佳实践 命名规范 包名: 小写，简短，有意义 变量: 驼峰命名法，首字母小写 常量: 驼峰命名法或全大写 函数: 驼峰命名法，首字母大写表示导出 接口: 通常以 -er 结尾（如 Reader, Writer） 代码组织 // 推荐的文件组织方式 myapp/ ├── cmd/ # 应用程序入口 │ └── server/ │ └── main.go ├── internal/ # 私有代码 │ ├── config/ │ ├── handler/ │ └── service/ ├── pkg/ # 公共库代码 ├── api/ # API 定义 ├── web/ # Web 资源 ├── configs/ # 配置文件 ├── scripts/ # 脚本 ├── tests/ # 额外的测试文件 ├── docs/ # 文档 ├── go.mod ├── go.sum └── README.md 性能优化 预分配切片容量 // 好的做法 slice := make([]int, 0, 100) // 避免频繁扩容 for i := 0; i < 100; i++ { slice = append(slice, i) } 字符串拼接 // 低效 var result string for _, s := range strings { result += s } // 高效 var builder strings.Builder for _, s := range strings { builder.WriteString(s) } result := builder.String() 避免不必要的内存分配 // 重用切片 func processData(data []int) { buffer := make([]int, 0, len(data)) // 使用 buffer... buffer = buffer[:0] // 重置长度，保留容量 } 常见陷阱 1. 循环变量捕获 // 错误 for _, item := range items { go func() { fmt.Println(item) // 总是打印最后一个 item }() } // 正确 for _, item := range items { go func(item string) { fmt.Println(item) }(item) } 2. defer 在循环中 // 错误 - defer 会在函数结束时执行，可能导致资源泄漏 func processFiles(files []string) { for _, file := range files { f, err := os.Open(file) if err != nil { continue } defer f.Close() // 在循环中，defer 会累积 // 处理文件... } } // 正确 func processFiles(files []string) { for _, file := range files { func() { f, err := os.Open(file) if err != nil { return } defer f.Close() // 处理文件... }() } } 3. 切片和映射的零值 // 错误 var slice []int slice[0] = 1 // panic: index out of range var m map[string]int m["key"] = 1 // panic: assignment to entry in nil map // 正确 slice := make([]int, 10) slice[0] = 1 m := make(map[string]int) m["key"] = 1 错误处理最佳实践 不要忽略错误 在错误中提供上下文 使用错误包装（Go 1.13+） 定义自定义错误类型 // 自定义错误类型 type ValidationError struct { Field string Value interface{} Tag string } func (e ValidationError) Error() string { return fmt.Sprintf("validation failed on field &#39;%s&#39; with value &#39;%v&#39;", e.Field, e.Value) } 并发安全 使用通道传递数据 使用互斥锁保护共享状态 避免共享内存，通过通信共享 使用 context 控制协程生命周期 常用标准库 字符串处理 (strings) strings.Contains(s, substr) strings.HasPrefix(s, prefix) strings.HasSuffix(s, suffix) strings.Split(s, sep) strings.Join(slice, sep) strings.ToLower(s) strings.ToUpper(s) strings.TrimSpace(s) strings.Replace(s, old, new, n) 时间处理 (time) now := time.Now() time.Sleep(time.Second) future := now.Add(time.Hour) duration := future.Sub(now) // 格式化时间 formatted := now.Format("2006-01-02 15:04:05") // 解析时间 parsed, err := time.Parse("2006-01-02", "2023-01-01") 正则表达式 (regexp) pattern := `\d+` re, err := regexp.Compile(pattern) if err != nil { log.Fatal(err) } matched := re.MatchString("abc123def") matches := re.FindAllString("123 456 789", -1) replaced := re.ReplaceAllString("abc123def", "XXX") HTTP 客户端/服务器 // HTTP 服务器 http.HandleFunc("/", handler) log.Fatal(http.ListenAndServe(":8080", nil)) // HTTP 客户端 resp, err := http.Get("https://api.example.com") if err != nil { log.Fatal(err) } defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) 数据库操作 import "database/sql" import _ "github.com/lib/pq" db, err := sql.Open("postgres", connectionString) defer db.Close() // 查询 rows, err := db.Query("SELECT id, name FROM users") defer rows.Close() for rows.Next() { var id int var name string err := rows.Scan(&amp;id, &amp;name) if err != nil { log.Fatal(err) } fmt.Printf("ID: %d, Name: %s\n", id, name) } // 插入 result, err := db.Exec("INSERT INTO users (name) VALUES ($1)", "Alice") 部署和容器化 Dockerfile # 多阶段构建 FROM golang:1.19-alpine AS builder WORKDIR /app COPY go.mod go.sum ./ RUN go mod download COPY . . RUN CGO_ENABLED=0 GOOS=linux go build -o main . # 最终镜像 FROM alpine:latest RUN apk --no-cache add ca-certificates WORKDIR /root/ COPY --from=builder /app/main . CMD ["./main"] 优雅关闭 func main() { // 创建 HTTP 服务器 srv := &amp;http.Server{ Addr: ":8080", Handler: router, } go func() { if err := srv.ListenAndServe(); err != nil && err != http.ErrServerClosed { log.Fatalf("listen: %s\n", err) } }() // 等待中断信号 quit := make(chan os.Signal, 1) signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM) <-quit log.Println("Shutdown Server ...") // 优雅关闭 ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second) defer cancel() if err := srv.Shutdown(ctx); err != nil { log.Fatal("Server Shutdown:", err) } log.Println("Server exiting") }'><meta itemprop=datePublished content="2025-04-04T19:24:42+08:00"><meta itemprop=dateModified content="2025-05-14T15:17:04+08:00"><meta itemprop=wordCount content="4663"><meta itemprop=image content="https://mlcore-engine.github.io/home/me.png"><link rel=apple-touch-icon sizes=180x180 href=/favicon/favicon.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=manifest href=/favicon/site.webmanifest><link rel=mask-icon href=/favicon/safari-pinned-tab.svg color=#5bbad5><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config content="/favicon/browserconfig.xml"><meta name=theme-color content="#ffffff"><meta name=description content='Go 语言基础知识大全 目录 环境配置 基本数据类型 变量和常量 运算符 控制结构 复合数据类型 函数 方法和接口 错误处理 并发编程 输入输出 包和模块 最佳实践 环境配置 Go 代理设置 go env -w GOPROXY=https://goproxy.cn,direct go env -w GOPROXY=https://gocenter.io,direct 私有库配置 go env -w GOPRIVATE=your-private-repo.com git config --global url."https://username:token@private-repo.com".insteadOf "https://private-repo.com" 基本数据类型 整数类型 有符号整数: int8, int16, int32(rune), int64, int 无符号整数: uint8(byte), uint16, uint32, uint64, uint, uintptr 浮点数和复数 // 浮点数 var f1 float32 = 3.14 var f2 float64 = 3.14159 // 复数 var x complex128 = complex(1, 2) // 1+2i fmt.Println(real(x*y)) // 提取实部 fmt.Println(imag(x*y)) // 提取虚部 布尔类型 var b bool = true // && 的优先级高于 || if &#39;a&#39; <= c && c <= &#39;z&#39; || &#39;A&#39; <= c && c <= &#39;Z&#39; { // 处理字母 } 字符串 // 字符串操作 s := "hello world" len(s) // 字节数 utf8.RuneCountInString(s) // 字符数 // 修改字符串 c := []byte(s) c[0] = &#39;H&#39; s2 := string(c) // 字符串连接（高效方式） var buffer bytes.Buffer buffer.WriteString("hello") buffer.WriteString(" world") result := buffer.String() 变量和常量 变量声明的四种方式 // 1. 短变量声明 s := "hello" // 2. var 声明 var s string // 3. var 声明带初始化 var s = "hello" // 4. var 声明带类型和初始化 var s string = "hello" 常量和 iota const Pi = 3.14159 // iota 枚举器 type Weekday int const ( Sunday Weekday = iota // 0 Monday // 1 Tuesday // 2 Wednesday // 3 Thursday // 4 Friday // 5 Saturday // 6 ) 运算符 算术运算符 + - * / % ++ -- 位运算符 & // AND | // OR ^ // XOR (一元时表示按位取反) &^ // AND NOT (位清除) << // 左移 >> // 右移 // 实例 var x uint8 = 1<<1 | 1<<5 // 00100010 var y uint8 = 1<<1 | 1<<2 // 00000110 fmt.Printf("%08b\n", x&amp;y) // 00000010 fmt.Printf("%08b\n", x|y) // 00100110 fmt.Printf("%08b\n", x^y) // 00100100 fmt.Printf("%08b\n", x&^y) // 00100000 比较运算符 == != < <= > >= 逻辑运算符 && || ! 控制结构 if 语句 if condition { // 代码块 } else if condition2 { // 代码块 } else { // 代码块 } // if 初始化语句 if err := function(); err != nil { return err } switch 语句 // 表达式 switch switch value { case 1: fmt.Println("one") case 2, 3: fmt.Println("two or three") default: fmt.Println("other") } // 类型 switch switch v := x.(type) { case string: fmt.Printf("字符串: %s\n", v) case int: fmt.Printf("整数: %d\n", v) default: fmt.Printf("未知类型\n") } for 循环 // 基本 for 循环 for i := 0; i < 10; i++ { fmt.Println(i) } // while 风格 for condition { // 代码块 } // 无限循环 for { // 代码块 } // range 循环 for index, value := range slice { fmt.Printf("%d: %v\n", index, value) } 复合数据类型 数组 // 数组声明和初始化 var arr [5]int arr2 := [5]int{1, 2, 3, 4, 5} arr3 := [...]int{1, 2, 3} // 编译器推断长度 // 数组是值类型，传递时会复制 func modifyArray(arr *[5]int) { arr[0] = 100 } 切片 (Slice) // 创建切片 s1 := make([]int, 5) // 长度为5 s2 := make([]int, 5, 10) // 长度5，容量10 s3 := []int{1, 2, 3} // 切片操作 s1 = append(s1, 6) // 追加元素 copy(dest, src) // 复制切片 // 切片表达式 s[low:high] // 包含low，不包含high s[low:] // 从low到末尾 s[:high] // 从开始到high s[:] // 整个切片 // 删除元素 func remove(slice []int, i int) []int { copy(slice[i:], slice[i+1:]) return slice[:len(slice)-1] } 映射 (Map) // 创建和初始化 m1 := make(map[string]int) m2 := map[string]int{ "alice": 25, "bob": 30, } // 操作 m1["key"] = value value := m1["key"] delete(m1, "key") // 检查键是否存在 if value, ok := m1["key"]; ok { fmt.Println("存在:", value) } // 遍历 for key, value := range m1 { fmt.Printf("%s: %d\n", key, value) } 结构体 // 定义结构体 type Person struct { Name string Age int addr *Address // 嵌入指针 } type Address struct { City, Country string } // 创建结构体 p1 := Person{"Alice", 25, &amp;Address{"Shanghai", "China"}} p2 := Person{ Name: "Bob", Age: 30, } // 构造函数模式 func NewPerson(name string, age int) *Person { return &amp;Person{ Name: name, Age: age, } } // 匿名字段（嵌入） type Employee struct { Person // 匿名字段 ID int } 函数 函数定义 // 基本语法 func functionName(param1 type1, param2 type2) (returnType1, returnType2) { return value1, value2 } // 命名返回值 func divide(a, b int) (quotient, remainder int) { quotient = a / b remainder = a % b return // 裸return } // 可变参数 func sum(nums ...int) int { total := 0 for _, num := range nums { total += num } return total } 匿名函数和闭包 // 匿名函数 func() { fmt.Println("Hello") }() // 闭包 func counter() func() int { count := 0 return func() int { count++ return count } } c := counter() fmt.Println(c()) // 1 fmt.Println(c()) // 2 defer 语句 func readFile(filename string) error { file, err := os.Open(filename) if err != nil { return err } defer file.Close() // 确保文件关闭 // 读取文件内容 return nil } // defer 的执行顺序是后进先出 (LIFO) func example() { defer fmt.Println("1") defer fmt.Println("2") defer fmt.Println("3") // 输出: 3 2 1 } 高阶函数 // 函数作为参数 func apply(nums []int, fn func(int) int) []int { result := make([]int, len(nums)) for i, v := range nums { result[i] = fn(v) } return result } // 使用 doubled := apply([]int{1, 2, 3}, func(x int) int { return x * 2 }) 方法和接口 方法 type Rectangle struct { Width, Height float64 } // 值接收者 - 不能修改接收者 func (r Rectangle) Area() float64 { return r.Width * r.Height } // 指针接收者 - 可以修改接收者 func (r *Rectangle) Scale(factor float64) { r.Width *= factor r.Height *= factor } // 字符串表示方法 func (r Rectangle) String() string { return fmt.Sprintf("Rectangle(%v, %v)", r.Width, r.Height) } 接口 // 接口定义 type Stringer interface { String() string } type Sizer interface { Size() int } // 接口组合 type Printer interface { Stringer Print() } // 空接口 var x interface{} x = 42 x = "hello" x = []int{1, 2, 3} 类型断言和类型开关 // 类型断言 var i interface{} = "hello" s, ok := i.(string) if ok { fmt.Println("字符串:", s) } // 必须断言（可能panic） s := i.(string) // 类型开关 switch v := i.(type) { case string: fmt.Printf("字符串: %q\n", v) case int: fmt.Printf("整数: %d\n", v) default: fmt.Printf("未知类型: %T\n", v) } 错误处理 错误接口 type error interface { Error() string } // 创建错误 err := errors.New("something went wrong") err := fmt.Errorf("operation failed: %w", originalErr) // 错误包装 错误处理策略 1. 传播错误 func readConfig(filename string) (Config, error) { data, err := ioutil.ReadFile(filename) if err != nil { return Config{}, fmt.Errorf("read config: %w", err) } // 处理配置... return config, nil } 2. 重试机制 func WaitForServer(url string) error { const timeout = 1 * time.Minute deadline := time.Now().Add(timeout) for tries := 0; time.Now().Before(deadline); tries++ { _, err := http.Get(url) if err == nil { return nil } log.Printf("server not responding (%s); retrying...", err) time.Sleep(time.Second << uint(tries)) } return fmt.Errorf("server %s failed to respond after %s", url, timeout) } 3. 记录并继续 if err := doSomething(); err != nil { log.Printf("warning: %v", err) // 继续执行... } 4. 优雅退出 if err := criticalOperation(); err != nil { log.Fatalf("critical error: %v", err) } panic 和 recover func safeDivide(a, b int) (result int, err error) { defer func() { if r := recover(); r != nil { err = fmt.Errorf("panic occurred: %v", r) } }() if b == 0 { panic("division by zero") } result = a / b return } 并发编程 Goroutine // 启动协程 go function() go func() { fmt.Println("Hello from goroutine") }() // 避免主程序过早退出 func main() { go task() time.Sleep(time.Second) // 不推荐 } Channel // 无缓冲通道（同步） ch := make(chan int) // 有缓冲通道（异步） ch := make(chan int, 10) // 发送和接收 ch <- 42 // 发送 value := <-ch // 接收 value, ok := <-ch // 接收，ok表示通道是否关闭 // 关闭通道 close(ch) // 检查通道是否关闭 for value := range ch { fmt.Println(value) } 通道方向 // 只发送通道 func send(ch chan<- int) { ch <- 42 } // 只接收通道 func receive(ch <-chan int) { value := <-ch } select 语句 select { case msg1 := <-ch1: fmt.Println("received from ch1:", msg1) case msg2 := <-ch2: fmt.Println("received from ch2:", msg2) case <-time.After(1 * time.Second): fmt.Println("timeout") default: fmt.Println("no channel ready") } 同步原语 sync.WaitGroup var wg sync.WaitGroup for i := 0; i < 10; i++ { wg.Add(1) go func(i int) { defer wg.Done() fmt.Println("Worker", i) }(i) } wg.Wait() // 等待所有协程完成 sync.Mutex type Counter struct { mu sync.Mutex value int } func (c *Counter) Increment() { c.mu.Lock() defer c.mu.Unlock() c.value++ } func (c *Counter) Value() int { c.mu.Lock() defer c.mu.Unlock() return c.value } sync.RWMutex type SafeMap struct { mu sync.RWMutex m map[string]int } func (sm *SafeMap) Read(key string) int { sm.mu.RLock() defer sm.mu.RUnlock() return sm.m[key] } func (sm *SafeMap) Write(key string, value int) { sm.mu.Lock() defer sm.mu.Unlock() sm.m[key] = value } 并发模式 生产者-消费者 func producer(ch chan<- int) { for i := 0; i < 10; i++ { ch <- i } close(ch) } func consumer(ch <-chan int) { for value := range ch { fmt.Println("consumed:", value) } } func main() { ch := make(chan int) go producer(ch) consumer(ch) } Fan-in/Fan-out // Fan-out: 分发任务到多个协程 func fanOut(input <-chan int, workers int) []<-chan int { outputs := make([]<-chan int, workers) for i := 0; i < workers; i++ { output := make(chan int) outputs[i] = output go func() { defer close(output) for n := range input { output <- process(n) } }() } return outputs } // Fan-in: 合并多个协程的结果 func fanIn(channels ...<-chan int) <-chan int { output := make(chan int) var wg sync.WaitGroup for _, ch := range channels { wg.Add(1) go func(ch <-chan int) { defer wg.Done() for value := range ch { output <- value } }(ch) } go func() { wg.Wait() close(output) }() return output } 输入输出 格式化输出 // Printf 常用格式 %v // 默认格式 %+v // 带字段名的结构体 %#v // Go语法表示 %T // 类型 %t // 布尔值 %d // 十进制整数 %b // 二进制 %o // 八进制 %x // 十六进制（小写） %X // 十六进制（大写） %f // 浮点数 %e // 科学计数法（小写e） %E // 科学计数法（大写E） %s // 字符串 %q // 带引号的字符串 %p // 指针 输入操作 // 标准输入 var name string var age int fmt.Scan(&amp;name, &amp;age) fmt.Scanf("%s %d", &amp;name, &amp;age) // 从字符串读取 input := "Alice 25" fmt.Sscanf(input, "%s %d", &amp;name, &amp;age) // bufio 读取 reader := bufio.NewReader(os.Stdin) line, err := reader.ReadString(&#39;\n&#39;) 文件操作 读取文件 // 一次性读取整个文件 data, err := ioutil.ReadFile("file.txt") if err != nil { log.Fatal(err) } // 逐行读取 file, err := os.Open("file.txt") if err != nil { log.Fatal(err) } defer file.Close() scanner := bufio.NewScanner(file) for scanner.Scan() { line := scanner.Text() fmt.Println(line) } // 使用 bufio.Reader reader := bufio.NewReader(file) for { line, err := reader.ReadString(&#39;\n&#39;) if err == io.EOF { break } if err != nil { log.Fatal(err) } fmt.Print(line) } 写入文件 // 一次性写入 data := []byte("Hello, World!") err := ioutil.WriteFile("output.txt", data, 0644) // 使用 bufio.Writer file, err := os.Create("output.txt") if err != nil { log.Fatal(err) } defer file.Close() writer := bufio.NewWriter(file) writer.WriteString("Hello, World!\n") writer.Flush() // 格式化写入 fmt.Fprintf(file, "Name: %s, Age: %d\n", name, age) 文件复制 func copyFile(src, dst string) error { source, err := os.Open(src) if err != nil { return err } defer source.Close() destination, err := os.Create(dst) if err != nil { return err } defer destination.Close() _, err = io.Copy(destination, source) return err } JSON 处理 type Person struct { Name string `json:"name"` Age int `json:"age"` } // 编码到 JSON person := Person{Name: "Alice", Age: 25} data, err := json.Marshal(person) // 解码 JSON var person Person err := json.Unmarshal(data, &amp;person) // 从文件读取 JSON file, err := os.Open("data.json") defer file.Close() decoder := json.NewDecoder(file) err = decoder.Decode(&amp;person) // 写入 JSON 到文件 file, err := os.Create("output.json") defer file.Close() encoder := json.NewEncoder(file) err = encoder.Encode(person) 包和模块 包的基本概念 // 包声明（每个文件必须有） package main // 导入包 import ( "fmt" "strconv" "net/http" // 别名 str "strings" // 点导入（导入到当前命名空间） . "math" // 仅执行初始化 _ "net/http/pprof" ) Go Modules # 初始化模块 go mod init module-name # 添加依赖 go get github.com/user/repo go get github.com/user/repo@version # 更新依赖 go get -u ./... # 清理未使用的依赖 go mod tidy # 查看依赖 go list -m all # 下载依赖到本地缓存 go mod download go.mod 文件 module example.com/myapp go 1.19 require ( github.com/gin-gonic/gin v1.8.1 gorm.io/gorm v1.23.0 ) replace ( github.com/old/repo => github.com/new/repo v1.0.0 github.com/local/repo => ./local/path ) exclude github.com/broken/repo v1.0.0 包的初始化 var globalVar = initFunction() func init() { // 包初始化代码 // 在main函数之前执行 // 可以有多个init函数 } func initFunction() int { return 42 } 类型系统 类型定义 // 类型别名 type UserID int type Username string // 类型定义 type User struct { ID UserID Name Username } // 接口定义 type Reader interface { Read([]byte) (int, error) } // 函数类型 type Handler func(http.ResponseWriter, *http.Request) 类型断言和转换 // 类型转换（同底层类型） var x int = 42 var y float64 = float64(x) // 类型断言（接口到具体类型） var i interface{} = "hello" s := i.(string) // 安全类型断言 if s, ok := i.(string); ok { fmt.Println(s) } 嵌入和组合 // 结构体嵌入 type Engine struct { Power int } func (e Engine) Start() { fmt.Println("Engine started") } type Car struct { Engine // 嵌入Engine Brand string } // Car 自动获得 Engine 的方法 car := Car{Engine{100}, "Toyota"} car.Start() // 调用 Engine.Start() 反射 基本反射操作 import "reflect" func examine(x interface{}) { v := reflect.ValueOf(x) t := reflect.TypeOf(x) fmt.Printf("Type: %s\n", t) fmt.Printf("Value: %v\n", v) fmt.Printf("Kind: %s\n", v.Kind()) } // 修改值（需要传递指针） func modify(x interface{}) { v := reflect.ValueOf(x).Elem() if v.CanSet() { v.SetInt(100) } } var n int = 42 modify(&amp;n) // n 变为 100 结构体反射 type Person struct { Name string `json:"name" tag:"example"` Age int `json:"age"` } func inspectStruct(x interface{}) { v := reflect.ValueOf(x) t := reflect.TypeOf(x) for i := 0; i < v.NumField(); i++ { field := t.Field(i) value := v.Field(i) fmt.Printf("Field: %s, Type: %s, Value: %v\n", field.Name, field.Type, value) // 获取标签 tag := field.Tag.Get("json") fmt.Printf("JSON tag: %s\n", tag) } } 测试 单元测试 // math.go func Add(a, b int) int { return a + b } // math_test.go package main import "testing" func TestAdd(t *testing.T) { result := Add(2, 3) expected := 5 if result != expected { t.Errorf("Add(2, 3) = %d; want %d", result, expected) } } // 表格驱动测试 func TestAddTable(t *testing.T) { tests := []struct { a, b, expected int }{ {1, 2, 3}, {0, 0, 0}, {-1, 1, 0}, } for _, test := range tests { result := Add(test.a, test.b) if result != test.expected { t.Errorf("Add(%d, %d) = %d; want %d", test.a, test.b, result, test.expected) } } } 基准测试 func BenchmarkAdd(b *testing.B) { for i := 0; i < b.N; i++ { Add(1, 2) } } // 运行基准测试 // go test -bench=. // go test -bench=BenchmarkAdd -benchmem 示例测试 func ExampleAdd() { fmt.Println(Add(1, 2)) // Output: 3 } 工具和命令 常用命令 # 编译和运行 go run main.go go build go build -o myapp go install # 测试 go test go test -v go test -cover go test -bench=. # 格式化代码 go fmt ./... goimports -w . # 代码检查 go vet ./... golint ./... golangci-lint run # 依赖管理 go mod tidy go mod vendor go mod verify # 查看文档 go doc fmt.Println godoc -http=:6060 # 性能分析 go test -cpuprofile=cpu.prof go test -memprofile=mem.prof go tool pprof cpu.prof 编译选项 # 交叉编译 GOOS=linux GOARCH=amd64 go build GOOS=windows GOARCH=amd64 go build GOOS=darwin GOARCH=amd64 go build # 编译优化 go build -ldflags="-s -w" # 去除符号表和调试信息 go build -tags=release # 条件编译 最佳实践 命名规范 包名: 小写，简短，有意义 变量: 驼峰命名法，首字母小写 常量: 驼峰命名法或全大写 函数: 驼峰命名法，首字母大写表示导出 接口: 通常以 -er 结尾（如 Reader, Writer） 代码组织 // 推荐的文件组织方式 myapp/ ├── cmd/ # 应用程序入口 │ └── server/ │ └── main.go ├── internal/ # 私有代码 │ ├── config/ │ ├── handler/ │ └── service/ ├── pkg/ # 公共库代码 ├── api/ # API 定义 ├── web/ # Web 资源 ├── configs/ # 配置文件 ├── scripts/ # 脚本 ├── tests/ # 额外的测试文件 ├── docs/ # 文档 ├── go.mod ├── go.sum └── README.md 性能优化 预分配切片容量 // 好的做法 slice := make([]int, 0, 100) // 避免频繁扩容 for i := 0; i < 100; i++ { slice = append(slice, i) } 字符串拼接 // 低效 var result string for _, s := range strings { result += s } // 高效 var builder strings.Builder for _, s := range strings { builder.WriteString(s) } result := builder.String() 避免不必要的内存分配 // 重用切片 func processData(data []int) { buffer := make([]int, 0, len(data)) // 使用 buffer... buffer = buffer[:0] // 重置长度，保留容量 } 常见陷阱 1. 循环变量捕获 // 错误 for _, item := range items { go func() { fmt.Println(item) // 总是打印最后一个 item }() } // 正确 for _, item := range items { go func(item string) { fmt.Println(item) }(item) } 2. defer 在循环中 // 错误 - defer 会在函数结束时执行，可能导致资源泄漏 func processFiles(files []string) { for _, file := range files { f, err := os.Open(file) if err != nil { continue } defer f.Close() // 在循环中，defer 会累积 // 处理文件... } } // 正确 func processFiles(files []string) { for _, file := range files { func() { f, err := os.Open(file) if err != nil { return } defer f.Close() // 处理文件... }() } } 3. 切片和映射的零值 // 错误 var slice []int slice[0] = 1 // panic: index out of range var m map[string]int m["key"] = 1 // panic: assignment to entry in nil map // 正确 slice := make([]int, 10) slice[0] = 1 m := make(map[string]int) m["key"] = 1 错误处理最佳实践 不要忽略错误 在错误中提供上下文 使用错误包装（Go 1.13+） 定义自定义错误类型 // 自定义错误类型 type ValidationError struct { Field string Value interface{} Tag string } func (e ValidationError) Error() string { return fmt.Sprintf("validation failed on field &#39;%s&#39; with value &#39;%v&#39;", e.Field, e.Value) } 并发安全 使用通道传递数据 使用互斥锁保护共享状态 避免共享内存，通过通信共享 使用 context 控制协程生命周期 常用标准库 字符串处理 (strings) strings.Contains(s, substr) strings.HasPrefix(s, prefix) strings.HasSuffix(s, suffix) strings.Split(s, sep) strings.Join(slice, sep) strings.ToLower(s) strings.ToUpper(s) strings.TrimSpace(s) strings.Replace(s, old, new, n) 时间处理 (time) now := time.Now() time.Sleep(time.Second) future := now.Add(time.Hour) duration := future.Sub(now) // 格式化时间 formatted := now.Format("2006-01-02 15:04:05") // 解析时间 parsed, err := time.Parse("2006-01-02", "2023-01-01") 正则表达式 (regexp) pattern := `\d+` re, err := regexp.Compile(pattern) if err != nil { log.Fatal(err) } matched := re.MatchString("abc123def") matches := re.FindAllString("123 456 789", -1) replaced := re.ReplaceAllString("abc123def", "XXX") HTTP 客户端/服务器 // HTTP 服务器 http.HandleFunc("/", handler) log.Fatal(http.ListenAndServe(":8080", nil)) // HTTP 客户端 resp, err := http.Get("https://api.example.com") if err != nil { log.Fatal(err) } defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) 数据库操作 import "database/sql" import _ "github.com/lib/pq" db, err := sql.Open("postgres", connectionString) defer db.Close() // 查询 rows, err := db.Query("SELECT id, name FROM users") defer rows.Close() for rows.Next() { var id int var name string err := rows.Scan(&amp;id, &amp;name) if err != nil { log.Fatal(err) } fmt.Printf("ID: %d, Name: %s\n", id, name) } // 插入 result, err := db.Exec("INSERT INTO users (name) VALUES ($1)", "Alice") 部署和容器化 Dockerfile # 多阶段构建 FROM golang:1.19-alpine AS builder WORKDIR /app COPY go.mod go.sum ./ RUN go mod download COPY . . RUN CGO_ENABLED=0 GOOS=linux go build -o main . # 最终镜像 FROM alpine:latest RUN apk --no-cache add ca-certificates WORKDIR /root/ COPY --from=builder /app/main . CMD ["./main"] 优雅关闭 func main() { // 创建 HTTP 服务器 srv := &amp;http.Server{ Addr: ":8080", Handler: router, } go func() { if err := srv.ListenAndServe(); err != nil && err != http.ErrServerClosed { log.Fatalf("listen: %s\n", err) } }() // 等待中断信号 quit := make(chan os.Signal, 1) signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM) <-quit log.Println("Shutdown Server ...") // 优雅关闭 ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second) defer cancel() if err := srv.Shutdown(ctx); err != nil { log.Fatal("Server Shutdown:", err) } log.Println("Server exiting") } '><meta name=keywords content="AI,机器学习,golang,kubernetes,技术博客"><meta name=author content="高新"><meta property="og:type" content="article"><meta property="og:url" content="https://mlcore-engine.github.io/golang/foundation/"><meta property="og:title" content="Go 语言基础知识 | 高新 | AI平台开发工程师"><meta property="og:description" content='Go 语言基础知识大全 目录 环境配置 基本数据类型 变量和常量 运算符 控制结构 复合数据类型 函数 方法和接口 错误处理 并发编程 输入输出 包和模块 最佳实践 环境配置 Go 代理设置 go env -w GOPROXY=https://goproxy.cn,direct go env -w GOPROXY=https://gocenter.io,direct 私有库配置 go env -w GOPRIVATE=your-private-repo.com git config --global url."https://username:token@private-repo.com".insteadOf "https://private-repo.com" 基本数据类型 整数类型 有符号整数: int8, int16, int32(rune), int64, int 无符号整数: uint8(byte), uint16, uint32, uint64, uint, uintptr 浮点数和复数 // 浮点数 var f1 float32 = 3.14 var f2 float64 = 3.14159 // 复数 var x complex128 = complex(1, 2) // 1+2i fmt.Println(real(x*y)) // 提取实部 fmt.Println(imag(x*y)) // 提取虚部 布尔类型 var b bool = true // && 的优先级高于 || if &#39;a&#39; <= c && c <= &#39;z&#39; || &#39;A&#39; <= c && c <= &#39;Z&#39; { // 处理字母 } 字符串 // 字符串操作 s := "hello world" len(s) // 字节数 utf8.RuneCountInString(s) // 字符数 // 修改字符串 c := []byte(s) c[0] = &#39;H&#39; s2 := string(c) // 字符串连接（高效方式） var buffer bytes.Buffer buffer.WriteString("hello") buffer.WriteString(" world") result := buffer.String() 变量和常量 变量声明的四种方式 // 1. 短变量声明 s := "hello" // 2. var 声明 var s string // 3. var 声明带初始化 var s = "hello" // 4. var 声明带类型和初始化 var s string = "hello" 常量和 iota const Pi = 3.14159 // iota 枚举器 type Weekday int const ( Sunday Weekday = iota // 0 Monday // 1 Tuesday // 2 Wednesday // 3 Thursday // 4 Friday // 5 Saturday // 6 ) 运算符 算术运算符 + - * / % ++ -- 位运算符 & // AND | // OR ^ // XOR (一元时表示按位取反) &^ // AND NOT (位清除) << // 左移 >> // 右移 // 实例 var x uint8 = 1<<1 | 1<<5 // 00100010 var y uint8 = 1<<1 | 1<<2 // 00000110 fmt.Printf("%08b\n", x&amp;y) // 00000010 fmt.Printf("%08b\n", x|y) // 00100110 fmt.Printf("%08b\n", x^y) // 00100100 fmt.Printf("%08b\n", x&^y) // 00100000 比较运算符 == != < <= > >= 逻辑运算符 && || ! 控制结构 if 语句 if condition { // 代码块 } else if condition2 { // 代码块 } else { // 代码块 } // if 初始化语句 if err := function(); err != nil { return err } switch 语句 // 表达式 switch switch value { case 1: fmt.Println("one") case 2, 3: fmt.Println("two or three") default: fmt.Println("other") } // 类型 switch switch v := x.(type) { case string: fmt.Printf("字符串: %s\n", v) case int: fmt.Printf("整数: %d\n", v) default: fmt.Printf("未知类型\n") } for 循环 // 基本 for 循环 for i := 0; i < 10; i++ { fmt.Println(i) } // while 风格 for condition { // 代码块 } // 无限循环 for { // 代码块 } // range 循环 for index, value := range slice { fmt.Printf("%d: %v\n", index, value) } 复合数据类型 数组 // 数组声明和初始化 var arr [5]int arr2 := [5]int{1, 2, 3, 4, 5} arr3 := [...]int{1, 2, 3} // 编译器推断长度 // 数组是值类型，传递时会复制 func modifyArray(arr *[5]int) { arr[0] = 100 } 切片 (Slice) // 创建切片 s1 := make([]int, 5) // 长度为5 s2 := make([]int, 5, 10) // 长度5，容量10 s3 := []int{1, 2, 3} // 切片操作 s1 = append(s1, 6) // 追加元素 copy(dest, src) // 复制切片 // 切片表达式 s[low:high] // 包含low，不包含high s[low:] // 从low到末尾 s[:high] // 从开始到high s[:] // 整个切片 // 删除元素 func remove(slice []int, i int) []int { copy(slice[i:], slice[i+1:]) return slice[:len(slice)-1] } 映射 (Map) // 创建和初始化 m1 := make(map[string]int) m2 := map[string]int{ "alice": 25, "bob": 30, } // 操作 m1["key"] = value value := m1["key"] delete(m1, "key") // 检查键是否存在 if value, ok := m1["key"]; ok { fmt.Println("存在:", value) } // 遍历 for key, value := range m1 { fmt.Printf("%s: %d\n", key, value) } 结构体 // 定义结构体 type Person struct { Name string Age int addr *Address // 嵌入指针 } type Address struct { City, Country string } // 创建结构体 p1 := Person{"Alice", 25, &amp;Address{"Shanghai", "China"}} p2 := Person{ Name: "Bob", Age: 30, } // 构造函数模式 func NewPerson(name string, age int) *Person { return &amp;Person{ Name: name, Age: age, } } // 匿名字段（嵌入） type Employee struct { Person // 匿名字段 ID int } 函数 函数定义 // 基本语法 func functionName(param1 type1, param2 type2) (returnType1, returnType2) { return value1, value2 } // 命名返回值 func divide(a, b int) (quotient, remainder int) { quotient = a / b remainder = a % b return // 裸return } // 可变参数 func sum(nums ...int) int { total := 0 for _, num := range nums { total += num } return total } 匿名函数和闭包 // 匿名函数 func() { fmt.Println("Hello") }() // 闭包 func counter() func() int { count := 0 return func() int { count++ return count } } c := counter() fmt.Println(c()) // 1 fmt.Println(c()) // 2 defer 语句 func readFile(filename string) error { file, err := os.Open(filename) if err != nil { return err } defer file.Close() // 确保文件关闭 // 读取文件内容 return nil } // defer 的执行顺序是后进先出 (LIFO) func example() { defer fmt.Println("1") defer fmt.Println("2") defer fmt.Println("3") // 输出: 3 2 1 } 高阶函数 // 函数作为参数 func apply(nums []int, fn func(int) int) []int { result := make([]int, len(nums)) for i, v := range nums { result[i] = fn(v) } return result } // 使用 doubled := apply([]int{1, 2, 3}, func(x int) int { return x * 2 }) 方法和接口 方法 type Rectangle struct { Width, Height float64 } // 值接收者 - 不能修改接收者 func (r Rectangle) Area() float64 { return r.Width * r.Height } // 指针接收者 - 可以修改接收者 func (r *Rectangle) Scale(factor float64) { r.Width *= factor r.Height *= factor } // 字符串表示方法 func (r Rectangle) String() string { return fmt.Sprintf("Rectangle(%v, %v)", r.Width, r.Height) } 接口 // 接口定义 type Stringer interface { String() string } type Sizer interface { Size() int } // 接口组合 type Printer interface { Stringer Print() } // 空接口 var x interface{} x = 42 x = "hello" x = []int{1, 2, 3} 类型断言和类型开关 // 类型断言 var i interface{} = "hello" s, ok := i.(string) if ok { fmt.Println("字符串:", s) } // 必须断言（可能panic） s := i.(string) // 类型开关 switch v := i.(type) { case string: fmt.Printf("字符串: %q\n", v) case int: fmt.Printf("整数: %d\n", v) default: fmt.Printf("未知类型: %T\n", v) } 错误处理 错误接口 type error interface { Error() string } // 创建错误 err := errors.New("something went wrong") err := fmt.Errorf("operation failed: %w", originalErr) // 错误包装 错误处理策略 1. 传播错误 func readConfig(filename string) (Config, error) { data, err := ioutil.ReadFile(filename) if err != nil { return Config{}, fmt.Errorf("read config: %w", err) } // 处理配置... return config, nil } 2. 重试机制 func WaitForServer(url string) error { const timeout = 1 * time.Minute deadline := time.Now().Add(timeout) for tries := 0; time.Now().Before(deadline); tries++ { _, err := http.Get(url) if err == nil { return nil } log.Printf("server not responding (%s); retrying...", err) time.Sleep(time.Second << uint(tries)) } return fmt.Errorf("server %s failed to respond after %s", url, timeout) } 3. 记录并继续 if err := doSomething(); err != nil { log.Printf("warning: %v", err) // 继续执行... } 4. 优雅退出 if err := criticalOperation(); err != nil { log.Fatalf("critical error: %v", err) } panic 和 recover func safeDivide(a, b int) (result int, err error) { defer func() { if r := recover(); r != nil { err = fmt.Errorf("panic occurred: %v", r) } }() if b == 0 { panic("division by zero") } result = a / b return } 并发编程 Goroutine // 启动协程 go function() go func() { fmt.Println("Hello from goroutine") }() // 避免主程序过早退出 func main() { go task() time.Sleep(time.Second) // 不推荐 } Channel // 无缓冲通道（同步） ch := make(chan int) // 有缓冲通道（异步） ch := make(chan int, 10) // 发送和接收 ch <- 42 // 发送 value := <-ch // 接收 value, ok := <-ch // 接收，ok表示通道是否关闭 // 关闭通道 close(ch) // 检查通道是否关闭 for value := range ch { fmt.Println(value) } 通道方向 // 只发送通道 func send(ch chan<- int) { ch <- 42 } // 只接收通道 func receive(ch <-chan int) { value := <-ch } select 语句 select { case msg1 := <-ch1: fmt.Println("received from ch1:", msg1) case msg2 := <-ch2: fmt.Println("received from ch2:", msg2) case <-time.After(1 * time.Second): fmt.Println("timeout") default: fmt.Println("no channel ready") } 同步原语 sync.WaitGroup var wg sync.WaitGroup for i := 0; i < 10; i++ { wg.Add(1) go func(i int) { defer wg.Done() fmt.Println("Worker", i) }(i) } wg.Wait() // 等待所有协程完成 sync.Mutex type Counter struct { mu sync.Mutex value int } func (c *Counter) Increment() { c.mu.Lock() defer c.mu.Unlock() c.value++ } func (c *Counter) Value() int { c.mu.Lock() defer c.mu.Unlock() return c.value } sync.RWMutex type SafeMap struct { mu sync.RWMutex m map[string]int } func (sm *SafeMap) Read(key string) int { sm.mu.RLock() defer sm.mu.RUnlock() return sm.m[key] } func (sm *SafeMap) Write(key string, value int) { sm.mu.Lock() defer sm.mu.Unlock() sm.m[key] = value } 并发模式 生产者-消费者 func producer(ch chan<- int) { for i := 0; i < 10; i++ { ch <- i } close(ch) } func consumer(ch <-chan int) { for value := range ch { fmt.Println("consumed:", value) } } func main() { ch := make(chan int) go producer(ch) consumer(ch) } Fan-in/Fan-out // Fan-out: 分发任务到多个协程 func fanOut(input <-chan int, workers int) []<-chan int { outputs := make([]<-chan int, workers) for i := 0; i < workers; i++ { output := make(chan int) outputs[i] = output go func() { defer close(output) for n := range input { output <- process(n) } }() } return outputs } // Fan-in: 合并多个协程的结果 func fanIn(channels ...<-chan int) <-chan int { output := make(chan int) var wg sync.WaitGroup for _, ch := range channels { wg.Add(1) go func(ch <-chan int) { defer wg.Done() for value := range ch { output <- value } }(ch) } go func() { wg.Wait() close(output) }() return output } 输入输出 格式化输出 // Printf 常用格式 %v // 默认格式 %+v // 带字段名的结构体 %#v // Go语法表示 %T // 类型 %t // 布尔值 %d // 十进制整数 %b // 二进制 %o // 八进制 %x // 十六进制（小写） %X // 十六进制（大写） %f // 浮点数 %e // 科学计数法（小写e） %E // 科学计数法（大写E） %s // 字符串 %q // 带引号的字符串 %p // 指针 输入操作 // 标准输入 var name string var age int fmt.Scan(&amp;name, &amp;age) fmt.Scanf("%s %d", &amp;name, &amp;age) // 从字符串读取 input := "Alice 25" fmt.Sscanf(input, "%s %d", &amp;name, &amp;age) // bufio 读取 reader := bufio.NewReader(os.Stdin) line, err := reader.ReadString(&#39;\n&#39;) 文件操作 读取文件 // 一次性读取整个文件 data, err := ioutil.ReadFile("file.txt") if err != nil { log.Fatal(err) } // 逐行读取 file, err := os.Open("file.txt") if err != nil { log.Fatal(err) } defer file.Close() scanner := bufio.NewScanner(file) for scanner.Scan() { line := scanner.Text() fmt.Println(line) } // 使用 bufio.Reader reader := bufio.NewReader(file) for { line, err := reader.ReadString(&#39;\n&#39;) if err == io.EOF { break } if err != nil { log.Fatal(err) } fmt.Print(line) } 写入文件 // 一次性写入 data := []byte("Hello, World!") err := ioutil.WriteFile("output.txt", data, 0644) // 使用 bufio.Writer file, err := os.Create("output.txt") if err != nil { log.Fatal(err) } defer file.Close() writer := bufio.NewWriter(file) writer.WriteString("Hello, World!\n") writer.Flush() // 格式化写入 fmt.Fprintf(file, "Name: %s, Age: %d\n", name, age) 文件复制 func copyFile(src, dst string) error { source, err := os.Open(src) if err != nil { return err } defer source.Close() destination, err := os.Create(dst) if err != nil { return err } defer destination.Close() _, err = io.Copy(destination, source) return err } JSON 处理 type Person struct { Name string `json:"name"` Age int `json:"age"` } // 编码到 JSON person := Person{Name: "Alice", Age: 25} data, err := json.Marshal(person) // 解码 JSON var person Person err := json.Unmarshal(data, &amp;person) // 从文件读取 JSON file, err := os.Open("data.json") defer file.Close() decoder := json.NewDecoder(file) err = decoder.Decode(&amp;person) // 写入 JSON 到文件 file, err := os.Create("output.json") defer file.Close() encoder := json.NewEncoder(file) err = encoder.Encode(person) 包和模块 包的基本概念 // 包声明（每个文件必须有） package main // 导入包 import ( "fmt" "strconv" "net/http" // 别名 str "strings" // 点导入（导入到当前命名空间） . "math" // 仅执行初始化 _ "net/http/pprof" ) Go Modules # 初始化模块 go mod init module-name # 添加依赖 go get github.com/user/repo go get github.com/user/repo@version # 更新依赖 go get -u ./... # 清理未使用的依赖 go mod tidy # 查看依赖 go list -m all # 下载依赖到本地缓存 go mod download go.mod 文件 module example.com/myapp go 1.19 require ( github.com/gin-gonic/gin v1.8.1 gorm.io/gorm v1.23.0 ) replace ( github.com/old/repo => github.com/new/repo v1.0.0 github.com/local/repo => ./local/path ) exclude github.com/broken/repo v1.0.0 包的初始化 var globalVar = initFunction() func init() { // 包初始化代码 // 在main函数之前执行 // 可以有多个init函数 } func initFunction() int { return 42 } 类型系统 类型定义 // 类型别名 type UserID int type Username string // 类型定义 type User struct { ID UserID Name Username } // 接口定义 type Reader interface { Read([]byte) (int, error) } // 函数类型 type Handler func(http.ResponseWriter, *http.Request) 类型断言和转换 // 类型转换（同底层类型） var x int = 42 var y float64 = float64(x) // 类型断言（接口到具体类型） var i interface{} = "hello" s := i.(string) // 安全类型断言 if s, ok := i.(string); ok { fmt.Println(s) } 嵌入和组合 // 结构体嵌入 type Engine struct { Power int } func (e Engine) Start() { fmt.Println("Engine started") } type Car struct { Engine // 嵌入Engine Brand string } // Car 自动获得 Engine 的方法 car := Car{Engine{100}, "Toyota"} car.Start() // 调用 Engine.Start() 反射 基本反射操作 import "reflect" func examine(x interface{}) { v := reflect.ValueOf(x) t := reflect.TypeOf(x) fmt.Printf("Type: %s\n", t) fmt.Printf("Value: %v\n", v) fmt.Printf("Kind: %s\n", v.Kind()) } // 修改值（需要传递指针） func modify(x interface{}) { v := reflect.ValueOf(x).Elem() if v.CanSet() { v.SetInt(100) } } var n int = 42 modify(&amp;n) // n 变为 100 结构体反射 type Person struct { Name string `json:"name" tag:"example"` Age int `json:"age"` } func inspectStruct(x interface{}) { v := reflect.ValueOf(x) t := reflect.TypeOf(x) for i := 0; i < v.NumField(); i++ { field := t.Field(i) value := v.Field(i) fmt.Printf("Field: %s, Type: %s, Value: %v\n", field.Name, field.Type, value) // 获取标签 tag := field.Tag.Get("json") fmt.Printf("JSON tag: %s\n", tag) } } 测试 单元测试 // math.go func Add(a, b int) int { return a + b } // math_test.go package main import "testing" func TestAdd(t *testing.T) { result := Add(2, 3) expected := 5 if result != expected { t.Errorf("Add(2, 3) = %d; want %d", result, expected) } } // 表格驱动测试 func TestAddTable(t *testing.T) { tests := []struct { a, b, expected int }{ {1, 2, 3}, {0, 0, 0}, {-1, 1, 0}, } for _, test := range tests { result := Add(test.a, test.b) if result != test.expected { t.Errorf("Add(%d, %d) = %d; want %d", test.a, test.b, result, test.expected) } } } 基准测试 func BenchmarkAdd(b *testing.B) { for i := 0; i < b.N; i++ { Add(1, 2) } } // 运行基准测试 // go test -bench=. // go test -bench=BenchmarkAdd -benchmem 示例测试 func ExampleAdd() { fmt.Println(Add(1, 2)) // Output: 3 } 工具和命令 常用命令 # 编译和运行 go run main.go go build go build -o myapp go install # 测试 go test go test -v go test -cover go test -bench=. # 格式化代码 go fmt ./... goimports -w . # 代码检查 go vet ./... golint ./... golangci-lint run # 依赖管理 go mod tidy go mod vendor go mod verify # 查看文档 go doc fmt.Println godoc -http=:6060 # 性能分析 go test -cpuprofile=cpu.prof go test -memprofile=mem.prof go tool pprof cpu.prof 编译选项 # 交叉编译 GOOS=linux GOARCH=amd64 go build GOOS=windows GOARCH=amd64 go build GOOS=darwin GOARCH=amd64 go build # 编译优化 go build -ldflags="-s -w" # 去除符号表和调试信息 go build -tags=release # 条件编译 最佳实践 命名规范 包名: 小写，简短，有意义 变量: 驼峰命名法，首字母小写 常量: 驼峰命名法或全大写 函数: 驼峰命名法，首字母大写表示导出 接口: 通常以 -er 结尾（如 Reader, Writer） 代码组织 // 推荐的文件组织方式 myapp/ ├── cmd/ # 应用程序入口 │ └── server/ │ └── main.go ├── internal/ # 私有代码 │ ├── config/ │ ├── handler/ │ └── service/ ├── pkg/ # 公共库代码 ├── api/ # API 定义 ├── web/ # Web 资源 ├── configs/ # 配置文件 ├── scripts/ # 脚本 ├── tests/ # 额外的测试文件 ├── docs/ # 文档 ├── go.mod ├── go.sum └── README.md 性能优化 预分配切片容量 // 好的做法 slice := make([]int, 0, 100) // 避免频繁扩容 for i := 0; i < 100; i++ { slice = append(slice, i) } 字符串拼接 // 低效 var result string for _, s := range strings { result += s } // 高效 var builder strings.Builder for _, s := range strings { builder.WriteString(s) } result := builder.String() 避免不必要的内存分配 // 重用切片 func processData(data []int) { buffer := make([]int, 0, len(data)) // 使用 buffer... buffer = buffer[:0] // 重置长度，保留容量 } 常见陷阱 1. 循环变量捕获 // 错误 for _, item := range items { go func() { fmt.Println(item) // 总是打印最后一个 item }() } // 正确 for _, item := range items { go func(item string) { fmt.Println(item) }(item) } 2. defer 在循环中 // 错误 - defer 会在函数结束时执行，可能导致资源泄漏 func processFiles(files []string) { for _, file := range files { f, err := os.Open(file) if err != nil { continue } defer f.Close() // 在循环中，defer 会累积 // 处理文件... } } // 正确 func processFiles(files []string) { for _, file := range files { func() { f, err := os.Open(file) if err != nil { return } defer f.Close() // 处理文件... }() } } 3. 切片和映射的零值 // 错误 var slice []int slice[0] = 1 // panic: index out of range var m map[string]int m["key"] = 1 // panic: assignment to entry in nil map // 正确 slice := make([]int, 10) slice[0] = 1 m := make(map[string]int) m["key"] = 1 错误处理最佳实践 不要忽略错误 在错误中提供上下文 使用错误包装（Go 1.13+） 定义自定义错误类型 // 自定义错误类型 type ValidationError struct { Field string Value interface{} Tag string } func (e ValidationError) Error() string { return fmt.Sprintf("validation failed on field &#39;%s&#39; with value &#39;%v&#39;", e.Field, e.Value) } 并发安全 使用通道传递数据 使用互斥锁保护共享状态 避免共享内存，通过通信共享 使用 context 控制协程生命周期 常用标准库 字符串处理 (strings) strings.Contains(s, substr) strings.HasPrefix(s, prefix) strings.HasSuffix(s, suffix) strings.Split(s, sep) strings.Join(slice, sep) strings.ToLower(s) strings.ToUpper(s) strings.TrimSpace(s) strings.Replace(s, old, new, n) 时间处理 (time) now := time.Now() time.Sleep(time.Second) future := now.Add(time.Hour) duration := future.Sub(now) // 格式化时间 formatted := now.Format("2006-01-02 15:04:05") // 解析时间 parsed, err := time.Parse("2006-01-02", "2023-01-01") 正则表达式 (regexp) pattern := `\d+` re, err := regexp.Compile(pattern) if err != nil { log.Fatal(err) } matched := re.MatchString("abc123def") matches := re.FindAllString("123 456 789", -1) replaced := re.ReplaceAllString("abc123def", "XXX") HTTP 客户端/服务器 // HTTP 服务器 http.HandleFunc("/", handler) log.Fatal(http.ListenAndServe(":8080", nil)) // HTTP 客户端 resp, err := http.Get("https://api.example.com") if err != nil { log.Fatal(err) } defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) 数据库操作 import "database/sql" import _ "github.com/lib/pq" db, err := sql.Open("postgres", connectionString) defer db.Close() // 查询 rows, err := db.Query("SELECT id, name FROM users") defer rows.Close() for rows.Next() { var id int var name string err := rows.Scan(&amp;id, &amp;name) if err != nil { log.Fatal(err) } fmt.Printf("ID: %d, Name: %s\n", id, name) } // 插入 result, err := db.Exec("INSERT INTO users (name) VALUES ($1)", "Alice") 部署和容器化 Dockerfile # 多阶段构建 FROM golang:1.19-alpine AS builder WORKDIR /app COPY go.mod go.sum ./ RUN go mod download COPY . . RUN CGO_ENABLED=0 GOOS=linux go build -o main . # 最终镜像 FROM alpine:latest RUN apk --no-cache add ca-certificates WORKDIR /root/ COPY --from=builder /app/main . CMD ["./main"] 优雅关闭 func main() { // 创建 HTTP 服务器 srv := &amp;http.Server{ Addr: ":8080", Handler: router, } go func() { if err := srv.ListenAndServe(); err != nil && err != http.ErrServerClosed { log.Fatalf("listen: %s\n", err) } }() // 等待中断信号 quit := make(chan os.Signal, 1) signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM) <-quit log.Println("Shutdown Server ...") // 优雅关闭 ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second) defer cancel() if err := srv.Shutdown(ctx); err != nil { log.Fatal("Server Shutdown:", err) } log.Println("Server exiting") } '><meta property="og:image" content="https://mlcore-engine.github.io/home/me.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:url content="https://mlcore-engine.github.io/golang/foundation/"><meta name=twitter:title content="Go 语言基础知识 | 高新 | AI平台开发工程师"><meta name=twitter:description content='Go 语言基础知识大全 目录 环境配置 基本数据类型 变量和常量 运算符 控制结构 复合数据类型 函数 方法和接口 错误处理 并发编程 输入输出 包和模块 最佳实践 环境配置 Go 代理设置 go env -w GOPROXY=https://goproxy.cn,direct go env -w GOPROXY=https://gocenter.io,direct 私有库配置 go env -w GOPRIVATE=your-private-repo.com git config --global url."https://username:token@private-repo.com".insteadOf "https://private-repo.com" 基本数据类型 整数类型 有符号整数: int8, int16, int32(rune), int64, int 无符号整数: uint8(byte), uint16, uint32, uint64, uint, uintptr 浮点数和复数 // 浮点数 var f1 float32 = 3.14 var f2 float64 = 3.14159 // 复数 var x complex128 = complex(1, 2) // 1+2i fmt.Println(real(x*y)) // 提取实部 fmt.Println(imag(x*y)) // 提取虚部 布尔类型 var b bool = true // && 的优先级高于 || if &#39;a&#39; <= c && c <= &#39;z&#39; || &#39;A&#39; <= c && c <= &#39;Z&#39; { // 处理字母 } 字符串 // 字符串操作 s := "hello world" len(s) // 字节数 utf8.RuneCountInString(s) // 字符数 // 修改字符串 c := []byte(s) c[0] = &#39;H&#39; s2 := string(c) // 字符串连接（高效方式） var buffer bytes.Buffer buffer.WriteString("hello") buffer.WriteString(" world") result := buffer.String() 变量和常量 变量声明的四种方式 // 1. 短变量声明 s := "hello" // 2. var 声明 var s string // 3. var 声明带初始化 var s = "hello" // 4. var 声明带类型和初始化 var s string = "hello" 常量和 iota const Pi = 3.14159 // iota 枚举器 type Weekday int const ( Sunday Weekday = iota // 0 Monday // 1 Tuesday // 2 Wednesday // 3 Thursday // 4 Friday // 5 Saturday // 6 ) 运算符 算术运算符 + - * / % ++ -- 位运算符 & // AND | // OR ^ // XOR (一元时表示按位取反) &^ // AND NOT (位清除) << // 左移 >> // 右移 // 实例 var x uint8 = 1<<1 | 1<<5 // 00100010 var y uint8 = 1<<1 | 1<<2 // 00000110 fmt.Printf("%08b\n", x&amp;y) // 00000010 fmt.Printf("%08b\n", x|y) // 00100110 fmt.Printf("%08b\n", x^y) // 00100100 fmt.Printf("%08b\n", x&^y) // 00100000 比较运算符 == != < <= > >= 逻辑运算符 && || ! 控制结构 if 语句 if condition { // 代码块 } else if condition2 { // 代码块 } else { // 代码块 } // if 初始化语句 if err := function(); err != nil { return err } switch 语句 // 表达式 switch switch value { case 1: fmt.Println("one") case 2, 3: fmt.Println("two or three") default: fmt.Println("other") } // 类型 switch switch v := x.(type) { case string: fmt.Printf("字符串: %s\n", v) case int: fmt.Printf("整数: %d\n", v) default: fmt.Printf("未知类型\n") } for 循环 // 基本 for 循环 for i := 0; i < 10; i++ { fmt.Println(i) } // while 风格 for condition { // 代码块 } // 无限循环 for { // 代码块 } // range 循环 for index, value := range slice { fmt.Printf("%d: %v\n", index, value) } 复合数据类型 数组 // 数组声明和初始化 var arr [5]int arr2 := [5]int{1, 2, 3, 4, 5} arr3 := [...]int{1, 2, 3} // 编译器推断长度 // 数组是值类型，传递时会复制 func modifyArray(arr *[5]int) { arr[0] = 100 } 切片 (Slice) // 创建切片 s1 := make([]int, 5) // 长度为5 s2 := make([]int, 5, 10) // 长度5，容量10 s3 := []int{1, 2, 3} // 切片操作 s1 = append(s1, 6) // 追加元素 copy(dest, src) // 复制切片 // 切片表达式 s[low:high] // 包含low，不包含high s[low:] // 从low到末尾 s[:high] // 从开始到high s[:] // 整个切片 // 删除元素 func remove(slice []int, i int) []int { copy(slice[i:], slice[i+1:]) return slice[:len(slice)-1] } 映射 (Map) // 创建和初始化 m1 := make(map[string]int) m2 := map[string]int{ "alice": 25, "bob": 30, } // 操作 m1["key"] = value value := m1["key"] delete(m1, "key") // 检查键是否存在 if value, ok := m1["key"]; ok { fmt.Println("存在:", value) } // 遍历 for key, value := range m1 { fmt.Printf("%s: %d\n", key, value) } 结构体 // 定义结构体 type Person struct { Name string Age int addr *Address // 嵌入指针 } type Address struct { City, Country string } // 创建结构体 p1 := Person{"Alice", 25, &amp;Address{"Shanghai", "China"}} p2 := Person{ Name: "Bob", Age: 30, } // 构造函数模式 func NewPerson(name string, age int) *Person { return &amp;Person{ Name: name, Age: age, } } // 匿名字段（嵌入） type Employee struct { Person // 匿名字段 ID int } 函数 函数定义 // 基本语法 func functionName(param1 type1, param2 type2) (returnType1, returnType2) { return value1, value2 } // 命名返回值 func divide(a, b int) (quotient, remainder int) { quotient = a / b remainder = a % b return // 裸return } // 可变参数 func sum(nums ...int) int { total := 0 for _, num := range nums { total += num } return total } 匿名函数和闭包 // 匿名函数 func() { fmt.Println("Hello") }() // 闭包 func counter() func() int { count := 0 return func() int { count++ return count } } c := counter() fmt.Println(c()) // 1 fmt.Println(c()) // 2 defer 语句 func readFile(filename string) error { file, err := os.Open(filename) if err != nil { return err } defer file.Close() // 确保文件关闭 // 读取文件内容 return nil } // defer 的执行顺序是后进先出 (LIFO) func example() { defer fmt.Println("1") defer fmt.Println("2") defer fmt.Println("3") // 输出: 3 2 1 } 高阶函数 // 函数作为参数 func apply(nums []int, fn func(int) int) []int { result := make([]int, len(nums)) for i, v := range nums { result[i] = fn(v) } return result } // 使用 doubled := apply([]int{1, 2, 3}, func(x int) int { return x * 2 }) 方法和接口 方法 type Rectangle struct { Width, Height float64 } // 值接收者 - 不能修改接收者 func (r Rectangle) Area() float64 { return r.Width * r.Height } // 指针接收者 - 可以修改接收者 func (r *Rectangle) Scale(factor float64) { r.Width *= factor r.Height *= factor } // 字符串表示方法 func (r Rectangle) String() string { return fmt.Sprintf("Rectangle(%v, %v)", r.Width, r.Height) } 接口 // 接口定义 type Stringer interface { String() string } type Sizer interface { Size() int } // 接口组合 type Printer interface { Stringer Print() } // 空接口 var x interface{} x = 42 x = "hello" x = []int{1, 2, 3} 类型断言和类型开关 // 类型断言 var i interface{} = "hello" s, ok := i.(string) if ok { fmt.Println("字符串:", s) } // 必须断言（可能panic） s := i.(string) // 类型开关 switch v := i.(type) { case string: fmt.Printf("字符串: %q\n", v) case int: fmt.Printf("整数: %d\n", v) default: fmt.Printf("未知类型: %T\n", v) } 错误处理 错误接口 type error interface { Error() string } // 创建错误 err := errors.New("something went wrong") err := fmt.Errorf("operation failed: %w", originalErr) // 错误包装 错误处理策略 1. 传播错误 func readConfig(filename string) (Config, error) { data, err := ioutil.ReadFile(filename) if err != nil { return Config{}, fmt.Errorf("read config: %w", err) } // 处理配置... return config, nil } 2. 重试机制 func WaitForServer(url string) error { const timeout = 1 * time.Minute deadline := time.Now().Add(timeout) for tries := 0; time.Now().Before(deadline); tries++ { _, err := http.Get(url) if err == nil { return nil } log.Printf("server not responding (%s); retrying...", err) time.Sleep(time.Second << uint(tries)) } return fmt.Errorf("server %s failed to respond after %s", url, timeout) } 3. 记录并继续 if err := doSomething(); err != nil { log.Printf("warning: %v", err) // 继续执行... } 4. 优雅退出 if err := criticalOperation(); err != nil { log.Fatalf("critical error: %v", err) } panic 和 recover func safeDivide(a, b int) (result int, err error) { defer func() { if r := recover(); r != nil { err = fmt.Errorf("panic occurred: %v", r) } }() if b == 0 { panic("division by zero") } result = a / b return } 并发编程 Goroutine // 启动协程 go function() go func() { fmt.Println("Hello from goroutine") }() // 避免主程序过早退出 func main() { go task() time.Sleep(time.Second) // 不推荐 } Channel // 无缓冲通道（同步） ch := make(chan int) // 有缓冲通道（异步） ch := make(chan int, 10) // 发送和接收 ch <- 42 // 发送 value := <-ch // 接收 value, ok := <-ch // 接收，ok表示通道是否关闭 // 关闭通道 close(ch) // 检查通道是否关闭 for value := range ch { fmt.Println(value) } 通道方向 // 只发送通道 func send(ch chan<- int) { ch <- 42 } // 只接收通道 func receive(ch <-chan int) { value := <-ch } select 语句 select { case msg1 := <-ch1: fmt.Println("received from ch1:", msg1) case msg2 := <-ch2: fmt.Println("received from ch2:", msg2) case <-time.After(1 * time.Second): fmt.Println("timeout") default: fmt.Println("no channel ready") } 同步原语 sync.WaitGroup var wg sync.WaitGroup for i := 0; i < 10; i++ { wg.Add(1) go func(i int) { defer wg.Done() fmt.Println("Worker", i) }(i) } wg.Wait() // 等待所有协程完成 sync.Mutex type Counter struct { mu sync.Mutex value int } func (c *Counter) Increment() { c.mu.Lock() defer c.mu.Unlock() c.value++ } func (c *Counter) Value() int { c.mu.Lock() defer c.mu.Unlock() return c.value } sync.RWMutex type SafeMap struct { mu sync.RWMutex m map[string]int } func (sm *SafeMap) Read(key string) int { sm.mu.RLock() defer sm.mu.RUnlock() return sm.m[key] } func (sm *SafeMap) Write(key string, value int) { sm.mu.Lock() defer sm.mu.Unlock() sm.m[key] = value } 并发模式 生产者-消费者 func producer(ch chan<- int) { for i := 0; i < 10; i++ { ch <- i } close(ch) } func consumer(ch <-chan int) { for value := range ch { fmt.Println("consumed:", value) } } func main() { ch := make(chan int) go producer(ch) consumer(ch) } Fan-in/Fan-out // Fan-out: 分发任务到多个协程 func fanOut(input <-chan int, workers int) []<-chan int { outputs := make([]<-chan int, workers) for i := 0; i < workers; i++ { output := make(chan int) outputs[i] = output go func() { defer close(output) for n := range input { output <- process(n) } }() } return outputs } // Fan-in: 合并多个协程的结果 func fanIn(channels ...<-chan int) <-chan int { output := make(chan int) var wg sync.WaitGroup for _, ch := range channels { wg.Add(1) go func(ch <-chan int) { defer wg.Done() for value := range ch { output <- value } }(ch) } go func() { wg.Wait() close(output) }() return output } 输入输出 格式化输出 // Printf 常用格式 %v // 默认格式 %+v // 带字段名的结构体 %#v // Go语法表示 %T // 类型 %t // 布尔值 %d // 十进制整数 %b // 二进制 %o // 八进制 %x // 十六进制（小写） %X // 十六进制（大写） %f // 浮点数 %e // 科学计数法（小写e） %E // 科学计数法（大写E） %s // 字符串 %q // 带引号的字符串 %p // 指针 输入操作 // 标准输入 var name string var age int fmt.Scan(&amp;name, &amp;age) fmt.Scanf("%s %d", &amp;name, &amp;age) // 从字符串读取 input := "Alice 25" fmt.Sscanf(input, "%s %d", &amp;name, &amp;age) // bufio 读取 reader := bufio.NewReader(os.Stdin) line, err := reader.ReadString(&#39;\n&#39;) 文件操作 读取文件 // 一次性读取整个文件 data, err := ioutil.ReadFile("file.txt") if err != nil { log.Fatal(err) } // 逐行读取 file, err := os.Open("file.txt") if err != nil { log.Fatal(err) } defer file.Close() scanner := bufio.NewScanner(file) for scanner.Scan() { line := scanner.Text() fmt.Println(line) } // 使用 bufio.Reader reader := bufio.NewReader(file) for { line, err := reader.ReadString(&#39;\n&#39;) if err == io.EOF { break } if err != nil { log.Fatal(err) } fmt.Print(line) } 写入文件 // 一次性写入 data := []byte("Hello, World!") err := ioutil.WriteFile("output.txt", data, 0644) // 使用 bufio.Writer file, err := os.Create("output.txt") if err != nil { log.Fatal(err) } defer file.Close() writer := bufio.NewWriter(file) writer.WriteString("Hello, World!\n") writer.Flush() // 格式化写入 fmt.Fprintf(file, "Name: %s, Age: %d\n", name, age) 文件复制 func copyFile(src, dst string) error { source, err := os.Open(src) if err != nil { return err } defer source.Close() destination, err := os.Create(dst) if err != nil { return err } defer destination.Close() _, err = io.Copy(destination, source) return err } JSON 处理 type Person struct { Name string `json:"name"` Age int `json:"age"` } // 编码到 JSON person := Person{Name: "Alice", Age: 25} data, err := json.Marshal(person) // 解码 JSON var person Person err := json.Unmarshal(data, &amp;person) // 从文件读取 JSON file, err := os.Open("data.json") defer file.Close() decoder := json.NewDecoder(file) err = decoder.Decode(&amp;person) // 写入 JSON 到文件 file, err := os.Create("output.json") defer file.Close() encoder := json.NewEncoder(file) err = encoder.Encode(person) 包和模块 包的基本概念 // 包声明（每个文件必须有） package main // 导入包 import ( "fmt" "strconv" "net/http" // 别名 str "strings" // 点导入（导入到当前命名空间） . "math" // 仅执行初始化 _ "net/http/pprof" ) Go Modules # 初始化模块 go mod init module-name # 添加依赖 go get github.com/user/repo go get github.com/user/repo@version # 更新依赖 go get -u ./... # 清理未使用的依赖 go mod tidy # 查看依赖 go list -m all # 下载依赖到本地缓存 go mod download go.mod 文件 module example.com/myapp go 1.19 require ( github.com/gin-gonic/gin v1.8.1 gorm.io/gorm v1.23.0 ) replace ( github.com/old/repo => github.com/new/repo v1.0.0 github.com/local/repo => ./local/path ) exclude github.com/broken/repo v1.0.0 包的初始化 var globalVar = initFunction() func init() { // 包初始化代码 // 在main函数之前执行 // 可以有多个init函数 } func initFunction() int { return 42 } 类型系统 类型定义 // 类型别名 type UserID int type Username string // 类型定义 type User struct { ID UserID Name Username } // 接口定义 type Reader interface { Read([]byte) (int, error) } // 函数类型 type Handler func(http.ResponseWriter, *http.Request) 类型断言和转换 // 类型转换（同底层类型） var x int = 42 var y float64 = float64(x) // 类型断言（接口到具体类型） var i interface{} = "hello" s := i.(string) // 安全类型断言 if s, ok := i.(string); ok { fmt.Println(s) } 嵌入和组合 // 结构体嵌入 type Engine struct { Power int } func (e Engine) Start() { fmt.Println("Engine started") } type Car struct { Engine // 嵌入Engine Brand string } // Car 自动获得 Engine 的方法 car := Car{Engine{100}, "Toyota"} car.Start() // 调用 Engine.Start() 反射 基本反射操作 import "reflect" func examine(x interface{}) { v := reflect.ValueOf(x) t := reflect.TypeOf(x) fmt.Printf("Type: %s\n", t) fmt.Printf("Value: %v\n", v) fmt.Printf("Kind: %s\n", v.Kind()) } // 修改值（需要传递指针） func modify(x interface{}) { v := reflect.ValueOf(x).Elem() if v.CanSet() { v.SetInt(100) } } var n int = 42 modify(&amp;n) // n 变为 100 结构体反射 type Person struct { Name string `json:"name" tag:"example"` Age int `json:"age"` } func inspectStruct(x interface{}) { v := reflect.ValueOf(x) t := reflect.TypeOf(x) for i := 0; i < v.NumField(); i++ { field := t.Field(i) value := v.Field(i) fmt.Printf("Field: %s, Type: %s, Value: %v\n", field.Name, field.Type, value) // 获取标签 tag := field.Tag.Get("json") fmt.Printf("JSON tag: %s\n", tag) } } 测试 单元测试 // math.go func Add(a, b int) int { return a + b } // math_test.go package main import "testing" func TestAdd(t *testing.T) { result := Add(2, 3) expected := 5 if result != expected { t.Errorf("Add(2, 3) = %d; want %d", result, expected) } } // 表格驱动测试 func TestAddTable(t *testing.T) { tests := []struct { a, b, expected int }{ {1, 2, 3}, {0, 0, 0}, {-1, 1, 0}, } for _, test := range tests { result := Add(test.a, test.b) if result != test.expected { t.Errorf("Add(%d, %d) = %d; want %d", test.a, test.b, result, test.expected) } } } 基准测试 func BenchmarkAdd(b *testing.B) { for i := 0; i < b.N; i++ { Add(1, 2) } } // 运行基准测试 // go test -bench=. // go test -bench=BenchmarkAdd -benchmem 示例测试 func ExampleAdd() { fmt.Println(Add(1, 2)) // Output: 3 } 工具和命令 常用命令 # 编译和运行 go run main.go go build go build -o myapp go install # 测试 go test go test -v go test -cover go test -bench=. # 格式化代码 go fmt ./... goimports -w . # 代码检查 go vet ./... golint ./... golangci-lint run # 依赖管理 go mod tidy go mod vendor go mod verify # 查看文档 go doc fmt.Println godoc -http=:6060 # 性能分析 go test -cpuprofile=cpu.prof go test -memprofile=mem.prof go tool pprof cpu.prof 编译选项 # 交叉编译 GOOS=linux GOARCH=amd64 go build GOOS=windows GOARCH=amd64 go build GOOS=darwin GOARCH=amd64 go build # 编译优化 go build -ldflags="-s -w" # 去除符号表和调试信息 go build -tags=release # 条件编译 最佳实践 命名规范 包名: 小写，简短，有意义 变量: 驼峰命名法，首字母小写 常量: 驼峰命名法或全大写 函数: 驼峰命名法，首字母大写表示导出 接口: 通常以 -er 结尾（如 Reader, Writer） 代码组织 // 推荐的文件组织方式 myapp/ ├── cmd/ # 应用程序入口 │ └── server/ │ └── main.go ├── internal/ # 私有代码 │ ├── config/ │ ├── handler/ │ └── service/ ├── pkg/ # 公共库代码 ├── api/ # API 定义 ├── web/ # Web 资源 ├── configs/ # 配置文件 ├── scripts/ # 脚本 ├── tests/ # 额外的测试文件 ├── docs/ # 文档 ├── go.mod ├── go.sum └── README.md 性能优化 预分配切片容量 // 好的做法 slice := make([]int, 0, 100) // 避免频繁扩容 for i := 0; i < 100; i++ { slice = append(slice, i) } 字符串拼接 // 低效 var result string for _, s := range strings { result += s } // 高效 var builder strings.Builder for _, s := range strings { builder.WriteString(s) } result := builder.String() 避免不必要的内存分配 // 重用切片 func processData(data []int) { buffer := make([]int, 0, len(data)) // 使用 buffer... buffer = buffer[:0] // 重置长度，保留容量 } 常见陷阱 1. 循环变量捕获 // 错误 for _, item := range items { go func() { fmt.Println(item) // 总是打印最后一个 item }() } // 正确 for _, item := range items { go func(item string) { fmt.Println(item) }(item) } 2. defer 在循环中 // 错误 - defer 会在函数结束时执行，可能导致资源泄漏 func processFiles(files []string) { for _, file := range files { f, err := os.Open(file) if err != nil { continue } defer f.Close() // 在循环中，defer 会累积 // 处理文件... } } // 正确 func processFiles(files []string) { for _, file := range files { func() { f, err := os.Open(file) if err != nil { return } defer f.Close() // 处理文件... }() } } 3. 切片和映射的零值 // 错误 var slice []int slice[0] = 1 // panic: index out of range var m map[string]int m["key"] = 1 // panic: assignment to entry in nil map // 正确 slice := make([]int, 10) slice[0] = 1 m := make(map[string]int) m["key"] = 1 错误处理最佳实践 不要忽略错误 在错误中提供上下文 使用错误包装（Go 1.13+） 定义自定义错误类型 // 自定义错误类型 type ValidationError struct { Field string Value interface{} Tag string } func (e ValidationError) Error() string { return fmt.Sprintf("validation failed on field &#39;%s&#39; with value &#39;%v&#39;", e.Field, e.Value) } 并发安全 使用通道传递数据 使用互斥锁保护共享状态 避免共享内存，通过通信共享 使用 context 控制协程生命周期 常用标准库 字符串处理 (strings) strings.Contains(s, substr) strings.HasPrefix(s, prefix) strings.HasSuffix(s, suffix) strings.Split(s, sep) strings.Join(slice, sep) strings.ToLower(s) strings.ToUpper(s) strings.TrimSpace(s) strings.Replace(s, old, new, n) 时间处理 (time) now := time.Now() time.Sleep(time.Second) future := now.Add(time.Hour) duration := future.Sub(now) // 格式化时间 formatted := now.Format("2006-01-02 15:04:05") // 解析时间 parsed, err := time.Parse("2006-01-02", "2023-01-01") 正则表达式 (regexp) pattern := `\d+` re, err := regexp.Compile(pattern) if err != nil { log.Fatal(err) } matched := re.MatchString("abc123def") matches := re.FindAllString("123 456 789", -1) replaced := re.ReplaceAllString("abc123def", "XXX") HTTP 客户端/服务器 // HTTP 服务器 http.HandleFunc("/", handler) log.Fatal(http.ListenAndServe(":8080", nil)) // HTTP 客户端 resp, err := http.Get("https://api.example.com") if err != nil { log.Fatal(err) } defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) 数据库操作 import "database/sql" import _ "github.com/lib/pq" db, err := sql.Open("postgres", connectionString) defer db.Close() // 查询 rows, err := db.Query("SELECT id, name FROM users") defer rows.Close() for rows.Next() { var id int var name string err := rows.Scan(&amp;id, &amp;name) if err != nil { log.Fatal(err) } fmt.Printf("ID: %d, Name: %s\n", id, name) } // 插入 result, err := db.Exec("INSERT INTO users (name) VALUES ($1)", "Alice") 部署和容器化 Dockerfile # 多阶段构建 FROM golang:1.19-alpine AS builder WORKDIR /app COPY go.mod go.sum ./ RUN go mod download COPY . . RUN CGO_ENABLED=0 GOOS=linux go build -o main . # 最终镜像 FROM alpine:latest RUN apk --no-cache add ca-certificates WORKDIR /root/ COPY --from=builder /app/main . CMD ["./main"] 优雅关闭 func main() { // 创建 HTTP 服务器 srv := &amp;http.Server{ Addr: ":8080", Handler: router, } go func() { if err := srv.ListenAndServe(); err != nil && err != http.ErrServerClosed { log.Fatalf("listen: %s\n", err) } }() // 等待中断信号 quit := make(chan os.Signal, 1) signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM) <-quit log.Println("Shutdown Server ...") // 优雅关闭 ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second) defer cancel() if err := srv.Shutdown(ctx); err != nil { log.Fatal("Server Shutdown:", err) } log.Println("Server exiting") } '><meta name=twitter:image content="https://mlcore-engine.github.io/home/me.png"><link rel=canonical href=https://mlcore-engine.github.io/golang/foundation/><link rel=stylesheet href=/css/math.css><script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},svg:{fontCache:"global"}}</script><script id=MathJax-script async src=/js/mathjax/tex-svg.js></script></head><body><div class=container><header><h1>高新 | AI平台开发工程师</h1><a href=https://github.com/mlcore-engine/mlcore-engine class=github><i class="fab fa-github"></i></a><p class=description>AI平台开发工程师，专注于AI平台工程和Kubernetes云原生技术。拥有AI平台开发、GPU资源优化和AI服务部署经验</p></header><div class=content-container><main><h1>Go 语言基础知识</h1><h1 id=go-语言基础知识大全>Go 语言基础知识大全</h1><h2 id=目录>目录</h2><ol><li><a href=#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE>环境配置</a></li><li><a href=#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B>基本数据类型</a></li><li><a href=#%E5%8F%98%E9%87%8F%E5%92%8C%E5%B8%B8%E9%87%8F>变量和常量</a></li><li><a href=#%E8%BF%90%E7%AE%97%E7%AC%A6>运算符</a></li><li><a href=#%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84>控制结构</a></li><li><a href=#%E5%A4%8D%E5%90%88%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B>复合数据类型</a></li><li><a href=#%E5%87%BD%E6%95%B0>函数</a></li><li><a href=#%E6%96%B9%E6%B3%95%E5%92%8C%E6%8E%A5%E5%8F%A3>方法和接口</a></li><li><a href=#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86>错误处理</a></li><li><a href=#%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B>并发编程</a></li><li><a href=#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA>输入输出</a></li><li><a href=#%E5%8C%85%E5%92%8C%E6%A8%A1%E5%9D%97>包和模块</a></li><li><a href=#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5>最佳实践</a></li></ol><h2 id=环境配置>环境配置</h2><h3 id=go-代理设置>Go 代理设置</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>go</span> <span style=color:#a6e22e>env</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>w</span> <span style=color:#a6e22e>GOPROXY</span>=<span style=color:#a6e22e>https</span>:<span style=color:#75715e>//goproxy.cn,direct</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>go</span> <span style=color:#a6e22e>env</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>w</span> <span style=color:#a6e22e>GOPROXY</span>=<span style=color:#a6e22e>https</span>:<span style=color:#75715e>//gocenter.io,direct</span>
</span></span></code></pre></div><h3 id=私有库配置>私有库配置</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go env -w GOPRIVATE<span style=color:#f92672>=</span>your-private-repo.com
</span></span><span style=display:flex><span>git config --global url.<span style=color:#e6db74>&#34;https://username:token@private-repo.com&#34;</span>.insteadOf <span style=color:#e6db74>&#34;https://private-repo.com&#34;</span>
</span></span></code></pre></div><h2 id=基本数据类型>基本数据类型</h2><h3 id=整数类型>整数类型</h3><ul><li><strong>有符号整数</strong>: <code>int8</code>, <code>int16</code>, <code>int32</code>(<code>rune</code>), <code>int64</code>, <code>int</code></li><li><strong>无符号整数</strong>: <code>uint8</code>(<code>byte</code>), <code>uint16</code>, <code>uint32</code>, <code>uint64</code>, <code>uint</code>, <code>uintptr</code></li></ul><h3 id=浮点数和复数>浮点数和复数</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 浮点数</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>f1</span> <span style=color:#66d9ef>float32</span> = <span style=color:#ae81ff>3.14</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>f2</span> <span style=color:#66d9ef>float64</span> = <span style=color:#ae81ff>3.14159</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 复数</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x</span> <span style=color:#66d9ef>complex128</span> = complex(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>) <span style=color:#75715e>// 1+2i</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(real(<span style=color:#a6e22e>x</span><span style=color:#f92672>*</span><span style=color:#a6e22e>y</span>))   <span style=color:#75715e>// 提取实部</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(imag(<span style=color:#a6e22e>x</span><span style=color:#f92672>*</span><span style=color:#a6e22e>y</span>))   <span style=color:#75715e>// 提取虚部</span>
</span></span></code></pre></div><h3 id=布尔类型>布尔类型</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>b</span> <span style=color:#66d9ef>bool</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// &amp;&amp; 的优先级高于 ||</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;a&#39;</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;z&#39;</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;A&#39;</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;Z&#39;</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 处理字母</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=字符串>字符串</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 字符串操作</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;hello world&#34;</span>
</span></span><span style=display:flex><span>len(<span style=color:#a6e22e>s</span>)           <span style=color:#75715e>// 字节数</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>utf8</span>.<span style=color:#a6e22e>RuneCountInString</span>(<span style=color:#a6e22e>s</span>)  <span style=color:#75715e>// 字符数</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 修改字符串</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> []byte(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>c</span>[<span style=color:#ae81ff>0</span>] = <span style=color:#e6db74>&#39;H&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s2</span> <span style=color:#f92672>:=</span> string(<span style=color:#a6e22e>c</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 字符串连接（高效方式）</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buffer</span> <span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>Buffer</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#e6db74>&#34;hello&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#e6db74>&#34; world&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>String</span>()
</span></span></code></pre></div><h2 id=变量和常量>变量和常量</h2><h3 id=变量声明的四种方式>变量声明的四种方式</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 1. 短变量声明</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;hello&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 2. var 声明</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 3. var 声明带初始化</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s</span> = <span style=color:#e6db74>&#34;hello&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 4. var 声明带类型和初始化</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span> = <span style=color:#e6db74>&#34;hello&#34;</span>
</span></span></code></pre></div><h3 id=常量和-iota>常量和 iota</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Pi</span> = <span style=color:#ae81ff>3.14159</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// iota 枚举器</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Weekday</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Sunday</span> <span style=color:#a6e22e>Weekday</span> = <span style=color:#66d9ef>iota</span>  <span style=color:#75715e>// 0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Monday</span>                 <span style=color:#75715e>// 1</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Tuesday</span>                <span style=color:#75715e>// 2</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Wednesday</span>              <span style=color:#75715e>// 3</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Thursday</span>               <span style=color:#75715e>// 4</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Friday</span>                 <span style=color:#75715e>// 5</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Saturday</span>               <span style=color:#75715e>// 6</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><h2 id=运算符>运算符</h2><h3 id=算术运算符>算术运算符</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>+</span> <span style=color:#f92672>-</span> <span style=color:#f92672>*</span> <span style=color:#f92672>/</span> <span style=color:#f92672>%</span>
</span></span><span style=display:flex><span><span style=color:#f92672>++</span> <span style=color:#f92672>--</span>
</span></span></code></pre></div><h3 id=位运算符>位运算符</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>&amp;</span>     <span style=color:#75715e>// AND</span>
</span></span><span style=display:flex><span>|     <span style=color:#75715e>// OR</span>
</span></span><span style=display:flex><span>^     <span style=color:#75715e>// XOR (一元时表示按位取反)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&amp;^</span>    <span style=color:#75715e>// AND NOT (位清除)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;&lt;</span>    <span style=color:#75715e>// 左移</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;</span>    <span style=color:#75715e>// 右移</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 实例</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x</span> <span style=color:#66d9ef>uint8</span> = <span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;&lt;</span><span style=color:#ae81ff>1</span> | <span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;&lt;</span><span style=color:#ae81ff>5</span>  <span style=color:#75715e>// 00100010</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>y</span> <span style=color:#66d9ef>uint8</span> = <span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;&lt;</span><span style=color:#ae81ff>1</span> | <span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;&lt;</span><span style=color:#ae81ff>2</span>  <span style=color:#75715e>// 00000110</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%08b\n&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>y</span>)  <span style=color:#75715e>// 00000010</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%08b\n&#34;</span>, <span style=color:#a6e22e>x</span>|<span style=color:#a6e22e>y</span>)  <span style=color:#75715e>// 00100110</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%08b\n&#34;</span>, <span style=color:#a6e22e>x</span>^<span style=color:#a6e22e>y</span>)  <span style=color:#75715e>// 00100100</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%08b\n&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>&amp;^</span><span style=color:#a6e22e>y</span>) <span style=color:#75715e>// 00100000</span>
</span></span></code></pre></div><h3 id=比较运算符>比较运算符</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>==</span> <span style=color:#f92672>!=</span> &lt; <span style=color:#f92672>&lt;=</span> &gt; <span style=color:#f92672>&gt;=</span>
</span></span></code></pre></div><h3 id=逻辑运算符>逻辑运算符</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>||</span> !
</span></span></code></pre></div><h2 id=控制结构>控制结构</h2><h3 id=if-语句>if 语句</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>condition</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 代码块</span>
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>condition2</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 代码块</span>
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 代码块</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// if 初始化语句</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>function</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=switch-语句>switch 语句</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 表达式 switch</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>value</span> {
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;one&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;two or three&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;other&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 类型 switch</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>x</span>.(<span style=color:#66d9ef>type</span>) {
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>string</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;字符串: %s\n&#34;</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>int</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;整数: %d\n&#34;</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;未知类型\n&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=for-循环>for 循环</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 基本 for 循环</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>10</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// while 风格</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>condition</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 代码块</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 无限循环</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 代码块</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// range 循环</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>index</span>, <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>slice</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%d: %v\n&#34;</span>, <span style=color:#a6e22e>index</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=复合数据类型>复合数据类型</h2><h3 id=数组>数组</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 数组声明和初始化</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>arr</span> [<span style=color:#ae81ff>5</span>]<span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>arr2</span> <span style=color:#f92672>:=</span> [<span style=color:#ae81ff>5</span>]<span style=color:#66d9ef>int</span>{<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>arr3</span> <span style=color:#f92672>:=</span> [<span style=color:#f92672>...</span>]<span style=color:#66d9ef>int</span>{<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>}  <span style=color:#75715e>// 编译器推断长度</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 数组是值类型，传递时会复制</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>modifyArray</span>(<span style=color:#a6e22e>arr</span> <span style=color:#f92672>*</span>[<span style=color:#ae81ff>5</span>]<span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>arr</span>[<span style=color:#ae81ff>0</span>] = <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=切片-slice>切片 (Slice)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 创建切片</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s1</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>5</span>)      <span style=color:#75715e>// 长度为5</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s2</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>10</span>)  <span style=color:#75715e>// 长度5，容量10</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s3</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>int</span>{<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 切片操作</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s1</span> = append(<span style=color:#a6e22e>s1</span>, <span style=color:#ae81ff>6</span>)        <span style=color:#75715e>// 追加元素</span>
</span></span><span style=display:flex><span>copy(<span style=color:#a6e22e>dest</span>, <span style=color:#a6e22e>src</span>)           <span style=color:#75715e>// 复制切片</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 切片表达式</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>low</span>:<span style=color:#a6e22e>high</span>]      <span style=color:#75715e>// 包含low，不包含high</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>low</span>:]          <span style=color:#75715e>// 从low到末尾</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span>[:<span style=color:#a6e22e>high</span>]         <span style=color:#75715e>// 从开始到high</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span>[:]             <span style=color:#75715e>// 整个切片</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 删除元素</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>remove</span>(<span style=color:#a6e22e>slice</span> []<span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>i</span> <span style=color:#66d9ef>int</span>) []<span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>    copy(<span style=color:#a6e22e>slice</span>[<span style=color:#a6e22e>i</span>:], <span style=color:#a6e22e>slice</span>[<span style=color:#a6e22e>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>:])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>slice</span>[:len(<span style=color:#a6e22e>slice</span>)<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=映射-map>映射 (Map)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 创建和初始化</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>m1</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>m2</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;alice&#34;</span>: <span style=color:#ae81ff>25</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;bob&#34;</span>:   <span style=color:#ae81ff>30</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 操作</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>m1</span>[<span style=color:#e6db74>&#34;key&#34;</span>] = <span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>m1</span>[<span style=color:#e6db74>&#34;key&#34;</span>]
</span></span><span style=display:flex><span>delete(<span style=color:#a6e22e>m1</span>, <span style=color:#e6db74>&#34;key&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 检查键是否存在</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>m1</span>[<span style=color:#e6db74>&#34;key&#34;</span>]; <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;存在:&#34;</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 遍历</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>m1</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%s: %d\n&#34;</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=结构体>结构体</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 定义结构体</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Person</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Age</span>  <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>addr</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Address</span>  <span style=color:#75715e>// 嵌入指针</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Address</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>City</span>, <span style=color:#a6e22e>Country</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建结构体</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>p1</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Person</span>{<span style=color:#e6db74>&#34;Alice&#34;</span>, <span style=color:#ae81ff>25</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Address</span>{<span style=color:#e6db74>&#34;Shanghai&#34;</span>, <span style=color:#e6db74>&#34;China&#34;</span>}}
</span></span><span style=display:flex><span><span style=color:#a6e22e>p2</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Person</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>: <span style=color:#e6db74>&#34;Bob&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Age</span>:  <span style=color:#ae81ff>30</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 构造函数模式</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewPerson</span>(<span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>age</span> <span style=color:#66d9ef>int</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>Person</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Person</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Name</span>: <span style=color:#a6e22e>name</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Age</span>:  <span style=color:#a6e22e>age</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 匿名字段（嵌入）</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Employee</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Person</span>        <span style=color:#75715e>// 匿名字段</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ID</span>     <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=函数>函数</h2><h3 id=函数定义>函数定义</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 基本语法</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>functionName</span>(<span style=color:#a6e22e>param1</span> <span style=color:#a6e22e>type1</span>, <span style=color:#a6e22e>param2</span> <span style=color:#a6e22e>type2</span>) (<span style=color:#a6e22e>returnType1</span>, <span style=color:#a6e22e>returnType2</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>value1</span>, <span style=color:#a6e22e>value2</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 命名返回值</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>divide</span>(<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span> <span style=color:#66d9ef>int</span>) (<span style=color:#a6e22e>quotient</span>, <span style=color:#a6e22e>remainder</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>quotient</span> = <span style=color:#a6e22e>a</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>b</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>remainder</span> = <span style=color:#a6e22e>a</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>b</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>  <span style=color:#75715e>// 裸return</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 可变参数</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>nums</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>total</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>num</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>nums</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>total</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>num</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>total</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=匿名函数和闭包>匿名函数和闭包</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 匿名函数</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Hello&#34;</span>)
</span></span><span style=display:flex><span>}()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 闭包</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>counter</span>() <span style=color:#66d9ef>func</span>() <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>count</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>func</span>() <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>count</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>count</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>counter</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>c</span>()) <span style=color:#75715e>// 1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>c</span>()) <span style=color:#75715e>// 2</span>
</span></span></code></pre></div><h3 id=defer-语句>defer 语句</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>readFile</span>(<span style=color:#a6e22e>filename</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>filename</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Close</span>()  <span style=color:#75715e>// 确保文件关闭</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 读取文件内容</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// defer 的执行顺序是后进先出 (LIFO)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>example</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;1&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;2&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;3&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 输出: 3 2 1</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=高阶函数>高阶函数</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 函数作为参数</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>apply</span>(<span style=color:#a6e22e>nums</span> []<span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>fn</span> <span style=color:#66d9ef>func</span>(<span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>int</span>) []<span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>int</span>, len(<span style=color:#a6e22e>nums</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>nums</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>result</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#a6e22e>fn</span>(<span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>doubled</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>apply</span>([]<span style=color:#66d9ef>int</span>{<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>}, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>x</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>int</span> { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> })
</span></span></code></pre></div><h2 id=方法和接口>方法和接口</h2><h3 id=方法>方法</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Rectangle</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Width</span>, <span style=color:#a6e22e>Height</span> <span style=color:#66d9ef>float64</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 值接收者 - 不能修改接收者</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#a6e22e>Rectangle</span>) <span style=color:#a6e22e>Area</span>() <span style=color:#66d9ef>float64</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Width</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Height</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 指针接收者 - 可以修改接收者</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Rectangle</span>) <span style=color:#a6e22e>Scale</span>(<span style=color:#a6e22e>factor</span> <span style=color:#66d9ef>float64</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Width</span> <span style=color:#f92672>*=</span> <span style=color:#a6e22e>factor</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Height</span> <span style=color:#f92672>*=</span> <span style=color:#a6e22e>factor</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 字符串表示方法</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#a6e22e>Rectangle</span>) <span style=color:#a6e22e>String</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;Rectangle(%v, %v)&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Width</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Height</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=接口>接口</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 接口定义</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Stringer</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>String</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Sizer</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Size</span>() <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 接口组合</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Printer</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Stringer</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Print</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 空接口</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x</span> <span style=color:#66d9ef>interface</span>{}
</span></span><span style=display:flex><span><span style=color:#a6e22e>x</span> = <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>x</span> = <span style=color:#e6db74>&#34;hello&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>x</span> = []<span style=color:#66d9ef>int</span>{<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>}
</span></span></code></pre></div><h3 id=类型断言和类型开关>类型断言和类型开关</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 类型断言</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#66d9ef>interface</span>{} = <span style=color:#e6db74>&#34;hello&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>i</span>.(<span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;字符串:&#34;</span>, <span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 必须断言（可能panic）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>i</span>.(<span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 类型开关</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>i</span>.(<span style=color:#66d9ef>type</span>) {
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>string</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;字符串: %q\n&#34;</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#66d9ef>int</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;整数: %d\n&#34;</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;未知类型: %T\n&#34;</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=错误处理>错误处理</h2><h3 id=错误接口>错误接口</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#66d9ef>error</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建错误</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;something went wrong&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;operation failed: %w&#34;</span>, <span style=color:#a6e22e>originalErr</span>)  <span style=color:#75715e>// 错误包装</span>
</span></span></code></pre></div><h3 id=错误处理策略>错误处理策略</h3><h4 id=1-传播错误>1. 传播错误</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>readConfig</span>(<span style=color:#a6e22e>filename</span> <span style=color:#66d9ef>string</span>) (<span style=color:#a6e22e>Config</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#a6e22e>filename</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Config</span>{}, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;read config: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 处理配置...</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>config</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=2-重试机制>2. 重试机制</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>WaitForServer</span>(<span style=color:#a6e22e>url</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>timeout</span> = <span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Minute</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>deadline</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>timeout</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>tries</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Before</span>(<span style=color:#a6e22e>deadline</span>); <span style=color:#a6e22e>tries</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>url</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;server not responding (%s); retrying...&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span> <span style=color:#f92672>&lt;&lt;</span> uint(<span style=color:#a6e22e>tries</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;server %s failed to respond after %s&#34;</span>, <span style=color:#a6e22e>url</span>, <span style=color:#a6e22e>timeout</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=3-记录并继续>3. 记录并继续</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>doSomething</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;warning: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 继续执行...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=4-优雅退出>4. 优雅退出</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>criticalOperation</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;critical error: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=panic-和-recover>panic 和 recover</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>safeDivide</span>(<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span> <span style=color:#66d9ef>int</span>) (<span style=color:#a6e22e>result</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> recover(); <span style=color:#a6e22e>r</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;panic occurred: %v&#34;</span>, <span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#e6db74>&#34;division by zero&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> = <span style=color:#a6e22e>a</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>b</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=并发编程>并发编程</h2><h3 id=goroutine>Goroutine</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 启动协程</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>go</span> <span style=color:#a6e22e>function</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Hello from goroutine&#34;</span>)
</span></span><span style=display:flex><span>}()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 避免主程序过早退出</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>task</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)  <span style=color:#75715e>// 不推荐</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=channel>Channel</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 无缓冲通道（同步）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 有缓冲通道（异步）</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 发送和接收</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>42</span>         <span style=color:#75715e>// 发送</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>    <span style=color:#75715e>// 接收</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span> <span style=color:#75715e>// 接收，ok表示通道是否关闭</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 关闭通道</span>
</span></span><span style=display:flex><span>close(<span style=color:#a6e22e>ch</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 检查通道是否关闭</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>ch</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=通道方向>通道方向</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 只发送通道</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>send</span>(<span style=color:#a6e22e>ch</span> <span style=color:#66d9ef>chan</span><span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 只接收通道</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>receive</span>(<span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=select-语句>select 语句</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#a6e22e>msg1</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch1</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;received from ch1:&#34;</span>, <span style=color:#a6e22e>msg1</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#a6e22e>msg2</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ch2</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;received from ch2:&#34;</span>, <span style=color:#a6e22e>msg2</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>After</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>):
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;timeout&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;no channel ready&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=同步原语>同步原语</h3><h4 id=syncwaitgroup>sync.WaitGroup</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>10</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>i</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Worker&#34;</span>, <span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>    }(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()  <span style=color:#75715e>// 等待所有协程完成</span>
</span></span></code></pre></div><h4 id=syncmutex>sync.Mutex</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Counter</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mu</span>    <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>Mutex</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>value</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Counter</span>) <span style=color:#a6e22e>Increment</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>value</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Counter</span>) <span style=color:#a6e22e>Value</span>() <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=syncrwmutex>sync.RWMutex</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SafeMap</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mu</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>m</span>  <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>sm</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>SafeMap</span>) <span style=color:#a6e22e>Read</span>(<span style=color:#a6e22e>key</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sm</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>RLock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>sm</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>RUnlock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>sm</span>.<span style=color:#a6e22e>m</span>[<span style=color:#a6e22e>key</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>sm</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>SafeMap</span>) <span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>key</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>value</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sm</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>sm</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sm</span>.<span style=color:#a6e22e>m</span>[<span style=color:#a6e22e>key</span>] = <span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=并发模式>并发模式</h3><h4 id=生产者-消费者>生产者-消费者</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>producer</span>(<span style=color:#a6e22e>ch</span> <span style=color:#66d9ef>chan</span><span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>10</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>i</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    close(<span style=color:#a6e22e>ch</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>consumer</span>(<span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>ch</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;consumed:&#34;</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>producer</span>(<span style=color:#a6e22e>ch</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>consumer</span>(<span style=color:#a6e22e>ch</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=fan-infan-out>Fan-in/Fan-out</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Fan-out: 分发任务到多个协程</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>fanOut</span>(<span style=color:#a6e22e>input</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>workers</span> <span style=color:#66d9ef>int</span>) []<span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>outputs</span> <span style=color:#f92672>:=</span> make([]<span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>workers</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>workers</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>output</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>outputs</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#a6e22e>output</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>defer</span> close(<span style=color:#a6e22e>output</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>n</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>input</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>output</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>process</span>(<span style=color:#a6e22e>n</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>outputs</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Fan-in: 合并多个协程的结果</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>fanIn</span>(<span style=color:#a6e22e>channels</span> <span style=color:#f92672>...&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>) <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>output</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>ch</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>channels</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ch</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>ch</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>output</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }(<span style=color:#a6e22e>ch</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>        close(<span style=color:#a6e22e>output</span>)
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>output</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=输入输出>输入输出</h2><h3 id=格式化输出>格式化输出</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Printf 常用格式</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>v</span>    <span style=color:#75715e>// 默认格式</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%+</span><span style=color:#a6e22e>v</span>   <span style=color:#75715e>// 带字段名的结构体</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>v</span>   <span style=color:#75715e>// Go语法表示</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>T</span>    <span style=color:#75715e>// 类型</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>t</span>    <span style=color:#75715e>// 布尔值</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>d</span>    <span style=color:#75715e>// 十进制整数</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>b</span>    <span style=color:#75715e>// 二进制</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>o</span>    <span style=color:#75715e>// 八进制</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>x</span>    <span style=color:#75715e>// 十六进制（小写）</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>X</span>    <span style=color:#75715e>// 十六进制（大写）</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>f</span>    <span style=color:#75715e>// 浮点数</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>e</span>    <span style=color:#75715e>// 科学计数法（小写e）</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>E</span>    <span style=color:#75715e>// 科学计数法（大写E）</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>s</span>    <span style=color:#75715e>// 字符串</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>q</span>    <span style=color:#75715e>// 带引号的字符串</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span><span style=color:#a6e22e>p</span>    <span style=color:#75715e>// 指针</span>
</span></span></code></pre></div><h3 id=输入操作>输入操作</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 标准输入</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>age</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Scan</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>name</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>age</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Scanf</span>(<span style=color:#e6db74>&#34;%s %d&#34;</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>name</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>age</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 从字符串读取</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>input</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;Alice 25&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sscanf</span>(<span style=color:#a6e22e>input</span>, <span style=color:#e6db74>&#34;%s %d&#34;</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>name</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>age</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// bufio 读取</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>reader</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdin</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>line</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>ReadString</span>(<span style=color:#e6db74>&#39;\n&#39;</span>)
</span></span></code></pre></div><h3 id=文件操作>文件操作</h3><h4 id=读取文件>读取文件</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 一次性读取整个文件</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#e6db74>&#34;file.txt&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 逐行读取</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#e6db74>&#34;file.txt&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>scanner</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewScanner</span>(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Scan</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>line</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Text</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>line</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用 bufio.Reader</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>reader</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>line</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>ReadString</span>(<span style=color:#e6db74>&#39;\n&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>EOF</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Print</span>(<span style=color:#a6e22e>line</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=写入文件>写入文件</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 一次性写入</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>data</span> <span style=color:#f92672>:=</span> []byte(<span style=color:#e6db74>&#34;Hello, World!&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>WriteFile</span>(<span style=color:#e6db74>&#34;output.txt&#34;</span>, <span style=color:#a6e22e>data</span>, <span style=color:#ae81ff>0644</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 使用 bufio.Writer</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Create</span>(<span style=color:#e6db74>&#34;output.txt&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>writer</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewWriter</span>(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>writer</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#e6db74>&#34;Hello, World!\n&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>writer</span>.<span style=color:#a6e22e>Flush</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 格式化写入</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>file</span>, <span style=color:#e6db74>&#34;Name: %s, Age: %d\n&#34;</span>, <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>age</span>)
</span></span></code></pre></div><h4 id=文件复制>文件复制</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>copyFile</span>(<span style=color:#a6e22e>src</span>, <span style=color:#a6e22e>dst</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>source</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>src</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>source</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>destination</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Create</span>(<span style=color:#a6e22e>dst</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>destination</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Copy</span>(<span style=color:#a6e22e>destination</span>, <span style=color:#a6e22e>source</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=json-处理>JSON 处理</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Person</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Age</span>  <span style=color:#66d9ef>int</span>    <span style=color:#e6db74>`json:&#34;age&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 编码到 JSON</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>person</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Person</span>{<span style=color:#a6e22e>Name</span>: <span style=color:#e6db74>&#34;Alice&#34;</span>, <span style=color:#a6e22e>Age</span>: <span style=color:#ae81ff>25</span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>person</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 解码 JSON</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>person</span> <span style=color:#a6e22e>Person</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>person</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 从文件读取 JSON</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#e6db74>&#34;data.json&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>decoder</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewDecoder</span>(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>decoder</span>.<span style=color:#a6e22e>Decode</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>person</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 写入 JSON 到文件</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Create</span>(<span style=color:#e6db74>&#34;output.json&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>encoder</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewEncoder</span>(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>encoder</span>.<span style=color:#a6e22e>Encode</span>(<span style=color:#a6e22e>person</span>)
</span></span></code></pre></div><h2 id=包和模块>包和模块</h2><h3 id=包的基本概念>包的基本概念</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 包声明（每个文件必须有）</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 导入包</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;strconv&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 别名</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>str</span> <span style=color:#e6db74>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 点导入（导入到当前命名空间）</span>
</span></span><span style=display:flex><span>    . <span style=color:#e6db74>&#34;math&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 仅执行初始化</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;net/http/pprof&#34;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><h3 id=go-modules>Go Modules</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 初始化模块</span>
</span></span><span style=display:flex><span>go mod init module-name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 添加依赖</span>
</span></span><span style=display:flex><span>go get github.com/user/repo
</span></span><span style=display:flex><span>go get github.com/user/repo@version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 更新依赖</span>
</span></span><span style=display:flex><span>go get -u ./...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 清理未使用的依赖</span>
</span></span><span style=display:flex><span>go mod tidy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看依赖</span>
</span></span><span style=display:flex><span>go list -m all
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 下载依赖到本地缓存</span>
</span></span><span style=display:flex><span>go mod download
</span></span></code></pre></div><h3 id=gomod-文件>go.mod 文件</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>module</span> <span style=color:#a6e22e>example</span>.<span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>myapp</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>go</span> <span style=color:#ae81ff>1.19</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>require</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>github</span>.<span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>gin</span><span style=color:#f92672>-</span><span style=color:#a6e22e>gonic</span><span style=color:#f92672>/</span><span style=color:#a6e22e>gin</span> <span style=color:#a6e22e>v1</span><span style=color:#ae81ff>.8.1</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gorm</span>.<span style=color:#a6e22e>io</span><span style=color:#f92672>/</span><span style=color:#a6e22e>gorm</span> <span style=color:#a6e22e>v1</span><span style=color:#ae81ff>.23.0</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>replace</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>github</span>.<span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>old</span><span style=color:#f92672>/</span><span style=color:#a6e22e>repo</span> =&gt; <span style=color:#a6e22e>github</span>.<span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>new</span><span style=color:#f92672>/</span><span style=color:#a6e22e>repo</span> <span style=color:#a6e22e>v1</span><span style=color:#ae81ff>.0.0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>github</span>.<span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>local</span><span style=color:#f92672>/</span><span style=color:#a6e22e>repo</span> =&gt; .<span style=color:#f92672>/</span><span style=color:#a6e22e>local</span><span style=color:#f92672>/</span><span style=color:#a6e22e>path</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>exclude</span> <span style=color:#a6e22e>github</span>.<span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>broken</span><span style=color:#f92672>/</span><span style=color:#a6e22e>repo</span> <span style=color:#a6e22e>v1</span><span style=color:#ae81ff>.0.0</span>
</span></span></code></pre></div><h3 id=包的初始化>包的初始化</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>globalVar</span> = <span style=color:#a6e22e>initFunction</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 包初始化代码</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 在main函数之前执行</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 可以有多个init函数</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>initFunction</span>() <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=类型系统>类型系统</h2><h3 id=类型定义>类型定义</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 类型别名</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>UserID</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Username</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 类型定义</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ID</span>   <span style=color:#a6e22e>UserID</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> <span style=color:#a6e22e>Username</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 接口定义</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Reader</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Read</span>([]<span style=color:#66d9ef>byte</span>) (<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 函数类型</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Handler</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>)
</span></span></code></pre></div><h3 id=类型断言和转换>类型断言和转换</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 类型转换（同底层类型）</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x</span> <span style=color:#66d9ef>int</span> = <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>y</span> <span style=color:#66d9ef>float64</span> = float64(<span style=color:#a6e22e>x</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 类型断言（接口到具体类型）</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#66d9ef>interface</span>{} = <span style=color:#e6db74>&#34;hello&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>i</span>.(<span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 安全类型断言</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>i</span>.(<span style=color:#66d9ef>string</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=嵌入和组合>嵌入和组合</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 结构体嵌入</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Engine</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Power</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>Engine</span>) <span style=color:#a6e22e>Start</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Engine started&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Car</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Engine</span>  <span style=color:#75715e>// 嵌入Engine</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Brand</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Car 自动获得 Engine 的方法</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>car</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Car</span>{<span style=color:#a6e22e>Engine</span>{<span style=color:#ae81ff>100</span>}, <span style=color:#e6db74>&#34;Toyota&#34;</span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>car</span>.<span style=color:#a6e22e>Start</span>()  <span style=color:#75715e>// 调用 Engine.Start()</span>
</span></span></code></pre></div><h2 id=反射>反射</h2><h3 id=基本反射操作>基本反射操作</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;reflect&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>examine</span>(<span style=color:#a6e22e>x</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>ValueOf</span>(<span style=color:#a6e22e>x</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>TypeOf</span>(<span style=color:#a6e22e>x</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Type: %s\n&#34;</span>, <span style=color:#a6e22e>t</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Value: %v\n&#34;</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Kind: %s\n&#34;</span>, <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>Kind</span>())
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 修改值（需要传递指针）</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>modify</span>(<span style=color:#a6e22e>x</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>ValueOf</span>(<span style=color:#a6e22e>x</span>).<span style=color:#a6e22e>Elem</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>CanSet</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>SetInt</span>(<span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>n</span> <span style=color:#66d9ef>int</span> = <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>modify</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>n</span>)  <span style=color:#75715e>// n 变为 100</span>
</span></span></code></pre></div><h3 id=结构体反射>结构体反射</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Person</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34; tag:&#34;example&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Age</span>  <span style=color:#66d9ef>int</span>    <span style=color:#e6db74>`json:&#34;age&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>inspectStruct</span>(<span style=color:#a6e22e>x</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>ValueOf</span>(<span style=color:#a6e22e>x</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>TypeOf</span>(<span style=color:#a6e22e>x</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>NumField</span>(); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>field</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Field</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>Field</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Field: %s, Type: %s, Value: %v\n&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>field</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>field</span>.<span style=color:#a6e22e>Type</span>, <span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 获取标签</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tag</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>field</span>.<span style=color:#a6e22e>Tag</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;json&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;JSON tag: %s\n&#34;</span>, <span style=color:#a6e22e>tag</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=测试>测试</h2><h3 id=单元测试>单元测试</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// math.go</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>int</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// math_test.go</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestAdd</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expected</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>expected</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Add(2, 3) = %d; want %d&#34;</span>, <span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>expected</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 表格驱动测试</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestAddTable</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tests</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>expected</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    }{
</span></span><span style=display:flex><span>        {<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>},
</span></span><span style=display:flex><span>        {<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>},
</span></span><span style=display:flex><span>        {<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>},
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>test</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>tests</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>test</span>.<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>test</span>.<span style=color:#a6e22e>b</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>test</span>.<span style=color:#a6e22e>expected</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Add(%d, %d) = %d; want %d&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>test</span>.<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>test</span>.<span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>test</span>.<span style=color:#a6e22e>expected</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=基准测试>基准测试</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>BenchmarkAdd</span>(<span style=color:#a6e22e>b</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>B</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>N</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 运行基准测试</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// go test -bench=.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// go test -bench=BenchmarkAdd -benchmem</span>
</span></span></code></pre></div><h3 id=示例测试>示例测试</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ExampleAdd</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Output: 3</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=工具和命令>工具和命令</h2><h3 id=常用命令>常用命令</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 编译和运行</span>
</span></span><span style=display:flex><span>go run main.go
</span></span><span style=display:flex><span>go build
</span></span><span style=display:flex><span>go build -o myapp
</span></span><span style=display:flex><span>go install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 测试</span>
</span></span><span style=display:flex><span>go test
</span></span><span style=display:flex><span>go test -v
</span></span><span style=display:flex><span>go test -cover
</span></span><span style=display:flex><span>go test -bench<span style=color:#f92672>=</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 格式化代码</span>
</span></span><span style=display:flex><span>go fmt ./...
</span></span><span style=display:flex><span>goimports -w .
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 代码检查</span>
</span></span><span style=display:flex><span>go vet ./...
</span></span><span style=display:flex><span>golint ./...
</span></span><span style=display:flex><span>golangci-lint run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 依赖管理</span>
</span></span><span style=display:flex><span>go mod tidy
</span></span><span style=display:flex><span>go mod vendor
</span></span><span style=display:flex><span>go mod verify
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看文档</span>
</span></span><span style=display:flex><span>go doc fmt.Println
</span></span><span style=display:flex><span>godoc -http<span style=color:#f92672>=</span>:6060
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 性能分析</span>
</span></span><span style=display:flex><span>go test -cpuprofile<span style=color:#f92672>=</span>cpu.prof
</span></span><span style=display:flex><span>go test -memprofile<span style=color:#f92672>=</span>mem.prof
</span></span><span style=display:flex><span>go tool pprof cpu.prof
</span></span></code></pre></div><h3 id=编译选项>编译选项</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 交叉编译</span>
</span></span><span style=display:flex><span>GOOS<span style=color:#f92672>=</span>linux GOARCH<span style=color:#f92672>=</span>amd64 go build
</span></span><span style=display:flex><span>GOOS<span style=color:#f92672>=</span>windows GOARCH<span style=color:#f92672>=</span>amd64 go build
</span></span><span style=display:flex><span>GOOS<span style=color:#f92672>=</span>darwin GOARCH<span style=color:#f92672>=</span>amd64 go build
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 编译优化</span>
</span></span><span style=display:flex><span>go build -ldflags<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-s -w&#34;</span>  <span style=color:#75715e># 去除符号表和调试信息</span>
</span></span><span style=display:flex><span>go build -tags<span style=color:#f92672>=</span>release     <span style=color:#75715e># 条件编译</span>
</span></span></code></pre></div><h2 id=最佳实践>最佳实践</h2><h3 id=命名规范>命名规范</h3><ol><li><strong>包名</strong>: 小写，简短，有意义</li><li><strong>变量</strong>: 驼峰命名法，首字母小写</li><li><strong>常量</strong>: 驼峰命名法或全大写</li><li><strong>函数</strong>: 驼峰命名法，首字母大写表示导出</li><li><strong>接口</strong>: 通常以 -er 结尾（如 Reader, Writer）</li></ol><h3 id=代码组织>代码组织</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 推荐的文件组织方式</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>myapp</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#a6e22e>cmd</span><span style=color:#f92672>/</span>           <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>应用程序入口</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>│</span>   <span style=color:#960050;background-color:#1e0010>└──</span> <span style=color:#a6e22e>server</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>│</span>       <span style=color:#960050;background-color:#1e0010>└──</span> <span style=color:#a6e22e>main</span>.<span style=color:#66d9ef>go</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#a6e22e>internal</span><span style=color:#f92672>/</span>      <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>私有代码</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>│</span>   <span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#a6e22e>config</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>│</span>   <span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#a6e22e>handler</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>│</span>   <span style=color:#960050;background-color:#1e0010>└──</span> <span style=color:#a6e22e>service</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#a6e22e>pkg</span><span style=color:#f92672>/</span>           <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>公共库代码</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#a6e22e>api</span><span style=color:#f92672>/</span>           <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>API</span> <span style=color:#a6e22e>定义</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#a6e22e>web</span><span style=color:#f92672>/</span>           <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>Web</span> <span style=color:#a6e22e>资源</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#a6e22e>configs</span><span style=color:#f92672>/</span>       <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>配置文件</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#a6e22e>scripts</span><span style=color:#f92672>/</span>       <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>脚本</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#a6e22e>tests</span><span style=color:#f92672>/</span>         <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>额外的测试文件</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#a6e22e>docs</span><span style=color:#f92672>/</span>          <span style=color:#960050;background-color:#1e0010>#</span> <span style=color:#a6e22e>文档</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#66d9ef>go</span>.<span style=color:#a6e22e>mod</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>├──</span> <span style=color:#66d9ef>go</span>.<span style=color:#a6e22e>sum</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>└──</span> <span style=color:#a6e22e>README</span>.<span style=color:#a6e22e>md</span>
</span></span></code></pre></div><h3 id=性能优化>性能优化</h3><ol><li><strong>预分配切片容量</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 好的做法</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>slice</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 避免频繁扩容</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>100</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>slice</span> = append(<span style=color:#a6e22e>slice</span>, <span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li><strong>字符串拼接</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 低效</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>result</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>strings</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>s</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 高效</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>builder</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>strings</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>String</span>()
</span></span></code></pre></div><ol start=3><li><strong>避免不必要的内存分配</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 重用切片</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>processData</span>(<span style=color:#a6e22e>data</span> []<span style=color:#66d9ef>int</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>buffer</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>0</span>, len(<span style=color:#a6e22e>data</span>))
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 使用 buffer...</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>buffer</span> = <span style=color:#a6e22e>buffer</span>[:<span style=color:#ae81ff>0</span>]  <span style=color:#75715e>// 重置长度，保留容量</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=常见陷阱>常见陷阱</h3><h4 id=1-循环变量捕获>1. 循环变量捕获</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 错误</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>item</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>items</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>item</span>) <span style=color:#75715e>// 总是打印最后一个 item</span>
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 正确</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>item</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>items</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>item</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>item</span>)
</span></span><span style=display:flex><span>    }(<span style=color:#a6e22e>item</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=2-defer-在循环中>2. defer 在循环中</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 错误 - defer 会在函数结束时执行，可能导致资源泄漏</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>processFiles</span>(<span style=color:#a6e22e>files</span> []<span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>file</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>files</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>f</span>.<span style=color:#a6e22e>Close</span>() <span style=color:#75715e>// 在循环中，defer 会累积</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 处理文件...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 正确</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>processFiles</span>(<span style=color:#a6e22e>files</span> []<span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>file</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>files</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>f</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 处理文件...</span>
</span></span><span style=display:flex><span>        }()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=3-切片和映射的零值>3. 切片和映射的零值</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 错误</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>slice</span> []<span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>slice</span>[<span style=color:#ae81ff>0</span>] = <span style=color:#ae81ff>1</span>  <span style=color:#75715e>// panic: index out of range</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>m</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>m</span>[<span style=color:#e6db74>&#34;key&#34;</span>] = <span style=color:#ae81ff>1</span>  <span style=color:#75715e>// panic: assignment to entry in nil map</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 正确</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>slice</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>int</span>, <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>slice</span>[<span style=color:#ae81ff>0</span>] = <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>m</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>m</span>[<span style=color:#e6db74>&#34;key&#34;</span>] = <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><h3 id=错误处理最佳实践>错误处理最佳实践</h3><ol><li><strong>不要忽略错误</strong></li><li><strong>在错误中提供上下文</strong></li><li><strong>使用错误包装</strong>（Go 1.13+）</li><li><strong>定义自定义错误类型</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// 自定义错误类型</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ValidationError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Field</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Value</span> <span style=color:#66d9ef>interface</span>{}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Tag</span>   <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>ValidationError</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;validation failed on field &#39;%s&#39; with value &#39;%v&#39;&#34;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Field</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Value</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=并发安全>并发安全</h3><ol><li><strong>使用通道传递数据</strong></li><li><strong>使用互斥锁保护共享状态</strong></li><li><strong>避免共享内存，通过通信共享</strong></li><li><strong>使用 context 控制协程生命周期</strong></li></ol><h2 id=常用标准库>常用标准库</h2><h3 id=字符串处理-strings>字符串处理 (strings)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Contains</span>(<span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>substr</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>HasPrefix</span>(<span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>prefix</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>HasSuffix</span>(<span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>suffix</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Split</span>(<span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>sep</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>slice</span>, <span style=color:#a6e22e>sep</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>ToLower</span>(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>ToUpper</span>(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>TrimSpace</span>(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Replace</span>(<span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>old</span>, <span style=color:#a6e22e>new</span>, <span style=color:#a6e22e>n</span>)
</span></span></code></pre></div><h3 id=时间处理-time>时间处理 (time)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>now</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>future</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Hour</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>duration</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>future</span>.<span style=color:#a6e22e>Sub</span>(<span style=color:#a6e22e>now</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 格式化时间</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>formatted</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>now</span>.<span style=color:#a6e22e>Format</span>(<span style=color:#e6db74>&#34;2006-01-02 15:04:05&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// 解析时间</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>parsed</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Parse</span>(<span style=color:#e6db74>&#34;2006-01-02&#34;</span>, <span style=color:#e6db74>&#34;2023-01-01&#34;</span>)
</span></span></code></pre></div><h3 id=正则表达式-regexp>正则表达式 (regexp)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>pattern</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>`\d+`</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>re</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>regexp</span>.<span style=color:#a6e22e>Compile</span>(<span style=color:#a6e22e>pattern</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>matched</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>re</span>.<span style=color:#a6e22e>MatchString</span>(<span style=color:#e6db74>&#34;abc123def&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>matches</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>re</span>.<span style=color:#a6e22e>FindAllString</span>(<span style=color:#e6db74>&#34;123 456 789&#34;</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>replaced</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>re</span>.<span style=color:#a6e22e>ReplaceAllString</span>(<span style=color:#e6db74>&#34;abc123def&#34;</span>, <span style=color:#e6db74>&#34;XXX&#34;</span>)
</span></span></code></pre></div><h3 id=http-客户端服务器>HTTP 客户端/服务器</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// HTTP 服务器</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#a6e22e>handler</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>, <span style=color:#66d9ef>nil</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// HTTP 客户端</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;https://api.example.com&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Body</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>body</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>ReadAll</span>(<span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Body</span>)
</span></span></code></pre></div><h3 id=数据库操作>数据库操作</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;database/sql&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;github.com/lib/pq&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>db</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#e6db74>&#34;postgres&#34;</span>, <span style=color:#a6e22e>connectionString</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 查询</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>rows</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Query</span>(<span style=color:#e6db74>&#34;SELECT id, name FROM users&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>rows</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>rows</span>.<span style=color:#a6e22e>Next</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rows</span>.<span style=color:#a6e22e>Scan</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>id</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>name</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;ID: %d, Name: %s\n&#34;</span>, <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>name</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 插入</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>Exec</span>(<span style=color:#e6db74>&#34;INSERT INTO users (name) VALUES ($1)&#34;</span>, <span style=color:#e6db74>&#34;Alice&#34;</span>)
</span></span></code></pre></div><h2 id=部署和容器化>部署和容器化</h2><h3 id=dockerfile>Dockerfile</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># 多阶段构建</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> golang:1.19-alpine AS builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> go.mod go.sum ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> go mod download<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> CGO_ENABLED<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> GOOS<span style=color:#f92672>=</span>linux go build -o main .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># 最终镜像</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> alpine:latest</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apk --no-cache add ca-certificates<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /root/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /app/main .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;./main&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=优雅关闭>优雅关闭</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建 HTTP 服务器</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>srv</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Server</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Addr</span>:    <span style=color:#e6db74>&#34;:8080&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Handler</span>: <span style=color:#a6e22e>router</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>srv</span>.<span style=color:#a6e22e>ListenAndServe</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ErrServerClosed</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;listen: %s\n&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 等待中断信号</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>quit</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Signal</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>signal</span>.<span style=color:#a6e22e>Notify</span>(<span style=color:#a6e22e>quit</span>, <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGINT</span>, <span style=color:#a6e22e>syscall</span>.<span style=color:#a6e22e>SIGTERM</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>quit</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Shutdown Server ...&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 优雅关闭</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#ae81ff>30</span><span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>srv</span>.<span style=color:#a6e22e>Shutdown</span>(<span style=color:#a6e22e>ctx</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#e6db74>&#34;Server Shutdown:&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Server exiting&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=edit-meta><br></div><nav class=pagination><a class="nav nav-prev" href=https://mlcore-engine.github.io/golang/matrix-golang/ title=matrix-golang><i class="fas fa-arrow-left" aria-hidden=true></i>&nbsp;Prev - matrix-golang</a>
<a class="nav nav-next" href=https://mlcore-engine.github.io/linux_foundation/ title=Linux基础>Next - Linux基础 <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://mlcore-engine.github.io/>about me</a></li><li class=has-sub-menu><a href=https://mlcore-engine.github.io/learn_cs/>cs基础<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlcore-engine.github.io/learn_cs/git-crash-course/>git-crash-course</a></li><li><a href=https://mlcore-engine.github.io/learn_cs/react-electron/ts-foundation/>ts-foundation</a></li><li><a href=https://mlcore-engine.github.io/learn_cs/react-electron/ipc/>ipc基础</a></li></ul></li><li class=has-sub-menu><a href=https://mlcore-engine.github.io/algorithm/>算法题<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlcore-engine.github.io/algorithm/stock_dp/>股票交易动态规划总结</a></li><li><a href=https://mlcore-engine.github.io/algorithm/strings/>string类题目</a></li><li><a href=https://mlcore-engine.github.io/algorithm/dynamic-programmnig/>动态规划问题</a></li></ul></li><li class=has-sub-menu><a href=https://mlcore-engine.github.io/math_foundation/>ML中的数学<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlcore-engine.github.io/math_foundation/information/>信息量</a></li><li><a href=https://mlcore-engine.github.io/math_foundation/likelihood_entropy/>似然函数_交叉熵</a></li><li><a href=https://mlcore-engine.github.io/math_foundation/kl_dpo/>Kl散度与dpo算法</a></li></ul></li><li class=has-sub-menu><a href=https://mlcore-engine.github.io/transformer/>ML基础<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlcore-engine.github.io/transformer/do_sample_para/>Do_sample_para</a></li><li><a href=https://mlcore-engine.github.io/transformer/entropy/>Entropy</a></li></ul></li><li class=has-sub-menu><a href=https://mlcore-engine.github.io/kubernetes/>kubernetes<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlcore-engine.github.io/kubernetes/installation/>Installation</a></li></ul></li><li><a href=https://mlcore-engine.github.io/learn_english/>英语学习</a></li><li class="parent has-sub-menu"><a href=https://mlcore-engine.github.io/golang/>golang<span class="mark opened">-</span></a><ul class=sub-menu><li><a href=https://mlcore-engine.github.io/golang/matrix-golang/>matrix-golang</a></li><li class=active><a href=https://mlcore-engine.github.io/golang/foundation/>Go 语言基础知识</a></li></ul></li><li class=has-sub-menu><a href=https://mlcore-engine.github.io/linux_foundation/>Linux基础<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlcore-engine.github.io/linux_foundation/linux-commands/>50个常用Linux命令</a></li><li><a href=https://mlcore-engine.github.io/linux_foundation/linux-common/>Linux Common</a></li></ul></li><li class=has-sub-menu><a href=https://mlcore-engine.github.io/exercise/>workout<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlcore-engine.github.io/exercise/workout/>Workout</a></li></ul></li><li class=has-sub-menu><a href=https://mlcore-engine.github.io/others/>others<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlcore-engine.github.io/others/create-hugo-gitpage/>使用 Hugo 和 GitHub Pages 创建个人网站</a></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>